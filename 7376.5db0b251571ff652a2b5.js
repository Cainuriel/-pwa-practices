(self.webpackChunkFB_App=self.webpackChunkFB_App||[]).push([[7376],{1390:(e,t,n)=>{"use strict";n.r(t);var r=n(156),i=n(3854),s=n(279),o=n(4762),a=n(9306),c=n(8604);const u=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},h=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),l=new a.Yd("@firebase/auth");function d(e,...t){l.logLevel<=a.in.ERROR&&l.error(`Auth (${s.SDK_VERSION}): ${e}`,...t)}function f(e,...t){throw y(e,...t)}function p(e,...t){return y(e,...t)}function g(e,t,n){const r=Object.assign(Object.assign({},{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function m(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&f(e,"argument-error"),g(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function y(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return h.create(e,...t)}function v(e,t,...n){if(!e)throw y(t,...n)}function w(e){const t="INTERNAL ASSERTION FAILED: "+e;throw d(t),new Error(t)}function I(e,t){e||w(t)}const T=new Map;function _(e){I(e instanceof Function,"Expected a class definition");let t=T.get(e);return t?(I(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,T.set(e,t),t)}function b(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function E(){return"http:"===k()||"https:"===k()}function k(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class S{constructor(e,t){this.shortDelay=e,this.longDelay=t,I(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(E()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function A(e,t){I(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class N{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void w("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void w("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void w("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const C={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},R=new S(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function P(e,t,n,r,s={}){return x(e,s,async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),N.fetch()(L(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))})}async function x(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},C),t);try{const t=new M(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw F(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw F(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw F(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw g(e,a,o);f(e,a)}}catch(s){if(s instanceof i.ZR)throw s;f(e,"network-request-failed")}}async function O(e,t,n,r,i={}){const s=await P(e,t,n,r,i);return"mfaPendingCredential"in s&&f(e,"multi-factor-auth-required",{_serverResponse:s}),s}function L(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?A(e.config,i):`${e.config.apiScheme}://${i}`}class M{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(p(this.auth,"network-request-failed")),R.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function F(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=p(e,t,r);return i.customData._tokenResponse=n,i}function U(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function V(e){return 1e3*Number(e)}function q(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return d("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(d("Failed to decode base64 JWT payload"),null)}catch(s){return d("Caught error parsing JWT payload as JSON",s),null}}async function j(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class B{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class z{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=U(this.lastLoginAt),this.creationTime=U(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function K(e){var t;const n=e.auth,r=await e.getIdToken(),i=await j(e,async function(e,t){return P(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));v(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map(e=>{var{providerId:t}=e,n=(0,o._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],c=(u=a,[...e.providerData.filter(e=>!u.some(t=>t.providerId===e.providerId)),...u]);var u;const h=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==c?void 0:c.length)),l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new z(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,l)}class G{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=q(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return v(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await x(e,{},async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=L(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",N.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new G;return n&&(v("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(v("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(v("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new G,this.toJSON())}_performRefresh(){return w("not implemented")}}function $(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class W{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,o._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new B(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.metadata=new z(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await j(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=q(r);v(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:U(V(s.auth_time)),issuedAtTime:U(V(s.iat)),expirationTime:U(V(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await K(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new W(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await K(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await j(this,async function(e,t){return P(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:I,isAnonymous:T,providerData:_,stsTokenManager:b}=t;v(w&&b,e,"internal-error");const E=G.fromJSON(this.name,b);v("string"==typeof w,e,"internal-error"),$(h,e.name),$(l,e.name),v("boolean"==typeof I,e,"internal-error"),v("boolean"==typeof T,e,"internal-error"),$(d,e.name),$(f,e.name),$(p,e.name),$(g,e.name),$(m,e.name),$(y,e.name);const k=new W({uid:w,auth:e,email:l,emailVerified:I,displayName:h,isAnonymous:T,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return _&&Array.isArray(_)&&(k.providerData=_.map(e=>Object.assign({},e))),g&&(k._redirectEventId=g),k}static async _fromIdTokenResponse(e,t,n=!1){const r=new G;r.updateFromServerResponse(t);const i=new W({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await K(i),i}}const H=(()=>{class e{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function Q(e,t,n){return`firebase:${e}:${t}:${n}`}class J{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Q(this.userKey,r.apiKey,i),this.fullPersistenceKey=Q("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?W._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new J(_(H),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||_(H);const s=Q(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const t=await u._get(s);if(t){const n=W._fromJSON(e,t);u!==i&&(o=n),i=u;break}}catch(c){}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(c){}})),new J(i,e,n)):new J(i,e,n)}}function Y(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(te(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(X(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(re(t))return"Blackberry";if(ie(t))return"Webos";if(Z(t))return"Safari";if((t.includes("chrome/")||ee(t))&&!t.includes("edge/"))return"Chrome";if(ne(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function X(e=(0,i.z$)()){return/firefox\//i.test(e)}function Z(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ee(e=(0,i.z$)()){return/crios\//i.test(e)}function te(e=(0,i.z$)()){return/iemobile/i.test(e)}function ne(e=(0,i.z$)()){return/android/i.test(e)}function re(e=(0,i.z$)()){return/blackberry/i.test(e)}function ie(e=(0,i.z$)()){return/webos/i.test(e)}function se(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)}function oe(e=(0,i.z$)()){return se(e)||ne(e)||ie(e)||re(e)||/windows phone/i.test(e)||te(e)}function ae(e,t=[]){let n;switch(e){case"Browser":n=Y((0,i.z$)());break;case"Worker":n=`${Y((0,i.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.SDK_VERSION}/${r}`}class ce{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new he(this),this.idTokenSubscription=new he(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=_(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await J.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e)):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(e);r&&r!==i||!(null==s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await K(e)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(_(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&_(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await J.create(this,[_(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return v(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ae(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function ue(e){return(0,i.m9)(e)}class he{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function le(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function de(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class fe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return w("not implemented")}_getIdTokenResponse(e){return w("not implemented")}_linkToIdToken(e,t){return w("not implemented")}_getReauthenticationResolver(e){return w("not implemented")}}async function pe(e,t){return P(e,"POST","/v1/accounts:resetPassword",D(e,t))}async function ge(e,t){return P(e,"POST","/v1/accounts:update",t)}async function me(e,t){return P(e,"POST","/v1/accounts:sendOobCode",D(e,t))}class ye extends fe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ye(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ye(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPassword",D(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}(e,{email:this._email,oobCode:this._password});default:f(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ge(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:f(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ve(e,t){return O(e,"POST","/v1/accounts:signInWithIdp",D(e,t))}class we extends fe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new we(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):f("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,o._T)(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new we(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ve(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const Ie={USER_NOT_FOUND:"user-not-found"};class Te extends fe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Te({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Te({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await O(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t));if(n.temporaryProof)throw F(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ie)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Te({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class _e{constructor(e){var t,n,r,s,o,a;const c=(0,i.zd)((0,i.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,h=null!==(n=c.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);v(u&&h&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=h,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new _e(t)}catch(n){return null}}}let be=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return ye._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=_e.parseLink(t);return v(n,"argument-error"),ye._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class Ee{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ke extends Ee{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Se extends ke{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return v("providerId"in t&&"signInMethod"in t,"argument-error"),we._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return v(e.idToken||e.accessToken,"argument-error"),we._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Se.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Se.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new Se(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(a){return null}}}let Ae=(()=>{class e extends ke{constructor(){super("facebook.com")}static credential(t){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch(n){return null}}}return e.FACEBOOK_SIGN_IN_METHOD="facebook.com",e.PROVIDER_ID="facebook.com",e})(),Ne=(()=>{class e extends ke{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch(i){return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})(),Ce=(()=>{class e extends ke{constructor(){super("github.com")}static credential(t){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch(n){return null}}}return e.GITHUB_SIGN_IN_METHOD="github.com",e.PROVIDER_ID="github.com",e})();class Re extends fe{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ve(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Re(n,i):null}static _create(e,t){return new Re(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class De extends Ee{constructor(e){v(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return De.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return De.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Re.fromJSON(e);return v(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Re._create(n,t)}catch(r){return null}}}let Pe=(()=>{class e extends ke{constructor(){super("twitter.com")}static credential(t,n){return we._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return e.credential(n,r)}catch(i){return null}}}return e.TWITTER_SIGN_IN_METHOD="twitter.com",e.PROVIDER_ID="twitter.com",e})();async function xe(e,t){return O(e,"POST","/v1/accounts:signUp",D(e,t))}class Oe{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await W._fromIdTokenResponse(e,n,r),s=Le(n);return new Oe({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Le(n);return new Oe({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Le(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Me extends i.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Me.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Me(e,t,n,r)}}function Fe(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Me._fromErrorAndOperation(e,n,t,r);throw n})}function Ue(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ve(e,t,n=!1){const r=await j(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Oe._forOperation(e,"link",r)}async function qe(e,t,n){await K(t);const r=!1===e?"provider-already-linked":"no-such-provider";v(Ue(t.providerData).has(n)===e,t.auth,r)}async function je(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await j(e,Fe(r,i,t,e),n);v(s.idToken,r,"internal-error");const o=q(s.idToken);v(o,r,"internal-error");const{sub:a}=o;return v(e.uid===a,r,"user-mismatch"),Oe._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&f(r,"user-mismatch"),s}}async function Be(e,t,n=!1){const r="signIn",i=await Fe(e,r,t),s=await Oe._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function ze(e,t){return Be(ue(e),t)}async function Ke(e,t){const n=(0,i.m9)(e);return await qe(!1,n,t.providerId),Ve(n,t)}async function Ge(e,t){return je((0,i.m9)(e),t)}class $e{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?We._fromServerResponse(e,t):f(e,"internal-error")}}class We extends $e{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new We(t)}}function He(e,t,n){var r;v((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),v(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(v(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(v(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Qe(e,t){const n=(0,i.m9)(e),r=await pe(n,{oobCode:t}),s=r.requestType;switch(v(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":v(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":v(r.mfaInfo,n,"internal-error");default:v(r.email,n,"internal-error")}let o=null;return r.mfaInfo&&(o=$e._fromServerResponse(ue(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function Je(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await j(e,ge(r,i));await e._updateTokensIfNecessary(s,!0)}class Ye{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Xe extends Ye{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Ze extends Ye{constructor(e,t){super(e,"facebook.com",t)}}class et extends Xe{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class tt extends Ye{constructor(e,t){super(e,"google.com",t)}}class nt extends Xe{constructor(e,t,n){super(e,"twitter.com",t,n)}}function rt(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=q(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Ye(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Ze(s,i);case"github.com":return new et(s,i);case"google.com":return new tt(s,i);case"twitter.com":return new nt(s,i,e.screenName||null);case"custom":case"anonymous":return new Ye(s,null);default:return new Ye(s,r,i)}}(n)}class it{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new it("enroll",e)}static _fromMfaPendingCredential(e){return new it("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return it._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return it._fromIdtoken(e.multiFactorSession.idToken)}return null}}class st{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=ue(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>$e._fromServerResponse(n,e));v(r.mfaPendingCredential,n,"internal-error");const s=it._fromMfaPendingCredential(r.mfaPendingCredential);return new st(s,i,async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Oe._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return v(t.user,n,"internal-error"),Oe._forOperation(t.user,t.operationType,o);default:f(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class ot{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>$e._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new ot(e)}async getSession(){return it._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),i=await j(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken(),r=await j(this.user,(i=this.user.auth,s={idToken:n,mfaEnrollmentId:t},P(i,"POST","/v2/accounts/mfaEnrollment:withdraw",D(i,s))));var i,s;this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(o){if("auth/user-token-expired"!==o.code)throw o}}}const at=new WeakMap,ct="__sak";class ut{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ct,"1"),this.storage.removeItem(ct),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const ht=(()=>{class e extends ut{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return Z(e)||se(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=oe(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}return e.type="LOCAL",e})(),lt=(()=>{class e extends ut{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let dt=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map(async e=>e(t.origin,i)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function ft(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class pt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const c=ft("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function gt(){return window}function mt(){return void 0!==gt().WorkerGlobalScope&&"function"==typeof gt().importScripts}const yt="firebaseLocalStorageDb",vt="firebaseLocalStorage",wt="fbase_key";class It{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Tt(e,t){return e.transaction([vt],t?"readwrite":"readonly").objectStore(vt)}function _t(){const e=indexedDB.open(yt,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(vt,{keyPath:wt})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(vt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(yt);return new It(e).toPromise()}(),t(await _t()))})})}async function bt(e,t,n){const r=Tt(e,!0).put({[wt]:t,value:n});return new It(r).toPromise()}function Et(e,t){const n=Tt(e,!0).delete(t);return new It(n).toPromise()}const kt=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await _t()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=dt._getInstance(mt()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new pt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _t();return await bt(e,ct,"1"),await Et(e,ct),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>bt(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Tt(e,!1).get(t),r=await new It(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Et(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Tt(e,!1).getAll();return new It(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function St(e){return new Promise((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=p("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})}function At(e){return`__${e}${Math.floor(1e6*Math.random())}`}const Nt=1e12;class Ct{constructor(e){this.auth=e,this.counter=Nt,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Rt(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Nt;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||Nt))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||Nt))||void 0===t||t.execute(),""}}class Rt{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;v(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<50;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Dt=At("rcb"),Pt=new S(3e4,6e4);class xt{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!gt().grecaptcha}load(e,t=""){return v(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(gt().grecaptcha):new Promise((n,r)=>{const s=gt().setTimeout(()=>{r(p(e,"network-request-failed"))},Pt.get());gt()[Dt]=()=>{gt().clearTimeout(s),delete gt()[Dt];const i=gt().grecaptcha;if(!i)return void r(p(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)},St(`https://www.google.com/recaptcha/api.js??${(0,i.xO)({onload:Dt,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(s),r(p(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!gt().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Ot{async load(e){return new Ct(e)}clearedOneInstance(){}}const Lt="recaptcha",Mt={theme:"light",type:"image"};class Ft{constructor(e,t=Object.assign({},Mt),n){this.parameters=t,this.type=Lt,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ue(n),this.isInvisible="invisible"===this.parameters.size,v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;v(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ot:new xt,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){v(!this.parameters.sitekey,this.auth,"argument-error"),v(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=gt()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){v(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){v(E()&&!mt(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await P(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);v(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return v(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ut{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Te._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Vt(e,t,n){var r;const i=await n.verify();try{let s;if(v("string"==typeof i,e,"argument-error"),v(n.type===Lt,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s)return v("enroll"===t.type,e,"internal-error"),(await function(e,t){return P(e,"POST","/v2/accounts/mfaEnrollment:start",D(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{v("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;return v(n,e,"missing-multi-factor-info"),(await function(e,t){return P(e,"POST","/v2/accounts/mfaSignIn:start",D(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return P(e,"POST","/v1/accounts:sendVerificationCode",D(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}let qt=(()=>{class e{constructor(t){this.providerId=e.PROVIDER_ID,this.auth=ue(t)}verifyPhoneNumber(e,t){return Vt(this.auth,e,(0,i.m9)(t))}static credential(e,t){return Te._fromVerification(e,t)}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Te._fromTokenResponse(t,n):null}}return e.PROVIDER_ID="phone",e.PHONE_SIGN_IN_METHOD="phone",e})();function jt(e,t){return t?_(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}class Bt extends fe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ve(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ve(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ve(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function zt(e){return Be(e.auth,new Bt(e),e.bypassAuthState)}function Kt(e){const{auth:t,user:n}=e;return v(n,t,"internal-error"),je(n,new Bt(e),e.bypassAuthState)}async function Gt(e){const{auth:t,user:n}=e;return v(n,t,"internal-error"),Ve(n,new Bt(e),e.bypassAuthState)}class $t{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return zt;case"linkViaPopup":case"linkViaRedirect":return Gt;case"reauthViaPopup":case"reauthViaRedirect":return Kt;default:f(this.auth,"internal-error")}}resolve(e){I(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){I(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Wt=new S(2e3,1e4);let Ht=(()=>{class e extends $t{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){I(1===this.filter.length,"Popup operations only handle one event");const e=ft();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(p(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,Wt.get())};e()}}return e.currentPopupAction=null,e})();const Qt=new Map;class Jt extends $t{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Qt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Zt(t),r=Xt(e);if(!(await r._isAvailable()))return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Qt.set(this.auth._key(),e)}return this.bypassAuthState||Qt.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Yt(e,t){return Xt(e)._set(Zt(t),"true")}function Xt(e){return _(e._redirectPersistence)}function Zt(e){return Q("pendingRedirect",e.config.apiKey,e.name)}async function en(e,t,n=!1){const r=ue(e),i=jt(r,t),s=new Jt(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function tn(e){const t=ft(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class nn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!sn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(p(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(rn(e))}saveEventToCache(e){this.cachedEventUids.add(rn(e)),this.lastProcessedEventTime=Date.now()}}function rn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function sn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function on(e,t={}){return P(e,"GET","/v1/projects",t)}const an=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cn=/^https?/;function un(e){const t=b(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!cn.test(n))return!1;if(an.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const hn=new S(3e4,6e4);function ln(){const e=gt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let dn=null;function fn(e){return dn=dn||function(e){return new Promise((t,n)=>{var r,i,s;function o(){ln(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ln(),n(p(e,"network-request-failed"))},timeout:hn.get()})}if(null===(i=null===(r=gt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=gt().gapi)||void 0===s?void 0:s.load)){const t=At("iframefcb");return gt()[t]=()=>{gapi.load?o():n(p(e,"network-request-failed"))},St(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw dn=null,e})}(e),dn}const pn=new S(5e3,15e3),gn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},mn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yn(e){const t=e.config;v(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?A(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:s.SDK_VERSION},o=mn.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,i.xO)(r).slice(1)}`}const vn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class wn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function In(e,t,n,r,o,a){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.SDK_VERSION,eventId:o};if(t instanceof Ee){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof ke){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const i of Object.keys(u))void 0===u[i]&&delete u[i];return`${function({config:e}){return e.emulator?A(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,i.xO)(u).slice(1)}`}const Tn="webStorageSupport";class _n extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return w("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new _n(e)}_finalizeEnroll(e,t,n){return function(e,t){return P(e,"POST","/v2/accounts/mfaEnrollment:finalize",D(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return P(e,"POST","/v2/accounts/mfaSignIn:finalize",D(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let bn=(()=>{class e{constructor(){}static assertion(e){return _n._fromCredential(e)}}return e.FACTOR_ID="phone",e})();var En,kn="@firebase/auth",Sn="0.19.7";class An{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Nn(){return window}En="Browser",(0,s._registerComponent)(new c.wA("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:r,authDomain:i}=n.options;return(e=>{v(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),v(!(null==i?void 0:i.includes(":")),"argument-error",{appName:e.name});const n={apiKey:r,authDomain:i,clientPlatform:En,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ae(En)},s=new ce(e,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(_);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(s,t),s})(n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,s._registerComponent)(new c.wA("auth-internal",e=>{return t=ue(e.getProvider("auth").getImmediate()),new An(t);var t},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.registerVersion)(kn,Sn,void 0),(0,s.registerVersion)(kn,Sn,"esm2017");class Cn extends nn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}async function Rn(e){const t=await Pn()._get(xn(e));return t&&await Pn()._remove(xn(e)),t}function Dn(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Pn(){return _(ht)}function xn(e){return Q("authEvent",e.config.apiKey,e.name)}function On(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,i.zd)(n.join("?"))}function Ln(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:p("no-auth-event")}}function Mn(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Fn(e=(0,i.z$)()){return!("file:"!==Mn()&&"ionic:"!==Mn()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Un(){try{const e=self.localStorage,t=ft();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=(0,i.z$)()){return(0,i.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,i.z$)()){return/Edge\/\d+/.test(e)}(e)}()||(0,i.hl)()}catch(e){return Vn()&&(0,i.hl)()}return!1}function Vn(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function qn(){return("http:"===Mn()||"https:"===Mn()||(0,i.ru)()||Fn())&&!((0,i.b$)()||(0,i.UG)())&&Un()&&!Vn()}function jn(){return Fn()&&"undefined"!=typeof document}const Bn={LOCAL:"local",NONE:"none",SESSION:"session"},zn=v,Kn="persistence";async function Gn(e){await e._initializationPromise;const t=$n(),n=Q(Kn,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function $n(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(t){return null}}const Wn=v;class Hn{constructor(){this.browserResolver=_(class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=lt,this._completeRedirectFn=en}async _openPopup(e,t,n,r){var s;return I(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},vn),{width:r.toString(),height:s.toString(),top:o,left:a}),h=(0,i.z$)().toLowerCase();n&&(c=ee(h)?"_blank":n),X(h)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,i.z$)()){var t;return se(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new wn(null);const d=window.open(t||"",c,l);v(d,e,"popup-blocked");try{d.focus()}catch(f){}return new wn(d)}(e,In(e,t,n,b(),r),ft())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=In(e,t,n,b(),r),gt().location.href=i,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(I(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await async function(e){const t=await fn(e),n=gt().gapi;return v(n,e,"internal-error"),t.open({where:document.body,url:yn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gn,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=p(e,"network-request-failed"),s=gt().setTimeout(()=>{r(i)},pn.get());function o(){gt().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}(e),n=new nn(e);return t.register("authEvent",t=>(v(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Tn,{type:Tn},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),f(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await on(e);for(const r of t)try{if(un(r))return}catch(n){}f(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oe()||Z()||se()}}),this.cordovaResolver=_(class{constructor(){this._redirectPersistence=lt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=en}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Cn(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){f(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,h;const l=Nn();v("function"==typeof(null===(t=null==l?void 0:l.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),v(void 0!==(null===(n=null==l?void 0:l.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),v("function"==typeof(null===(s=null===(i=null===(r=null==l?void 0:l.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null===(c=null===(a=null===(o=null==l?void 0:l.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null===(h=null===(u=null==l?void 0:l.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===h?void 0:h.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),Qt.clear(),await this._originValidation(e);const o=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Dn(),postBody:null,tenantId:e.tenantId,error:p(e,"no-auth-event")}}(e,n,r);await function(e,t){return Pn()._set(xn(e),t)}(e,o);const a=await async function(e,t,n){var r;const{BuildInfo:i}=Nn();I(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(I(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId),o={};return se()?o.ibi=i.packageName:ne()?o.apn=i.packageName:f(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,In(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,o,t);return async function(e,t,n){const{cordova:r}=Nn();let i=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout(()=>{o(p(e,"redirect-cancelled-by-user"))},2e3))}function h(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),ne()&&document.addEventListener("visibilitychange",h,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",h,!1),a&&window.clearTimeout(a)}})}finally{i()}}(e,s,await function(e){const{cordova:t}=Nn();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=(0,i.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)})})}(a))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Nn(),n={};se()?n.iosBundleId=t.packageName:ne()?n.androidPackageName=t.packageName:f(e,"operation-not-supported-in-this-environment"),await on(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=Nn(),s=setTimeout(async()=>{await Rn(e),t.onEvent(Ln())},500),o=async n=>{clearTimeout(s);const r=await Rn(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=On(e),n=t.link?decodeURIComponent(t.link):void 0,r=On(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return On(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=On(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?p(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||Ln())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;Nn().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(t){console.error(t)}}}}),this.underlyingResolver=null,this._redirectPersistence=lt,this._completeRedirectFn=en}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return jn()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Wn(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!jn()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Qn(e){return e.unwrap()}function Jn(e){const{_tokenResponse:t}=e instanceof i.ZR?e.customData:e;if(!t)return null;if(!(e instanceof i.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return qt.credentialFromResult(e);const n=t.providerId;if(!n||"password"===n)return null;let r;switch(n){case"google.com":r=Ne;break;case"facebook.com":r=Ae;break;case"github.com":r=Ce;break;case"twitter.com":r=Pe;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Re._create(n,o):we._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new Se(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof i.ZR?r.credentialFromError(e):r.credentialFromResult(e)}function Yn(e,t){return t.catch(t=>{throw t instanceof i.ZR&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code)t.resolver=new Zn(e,function(e,t){var n;const r=(0,i.m9)(e),s=t;return v(t.customData.operationType,r,"argument-error"),v(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),st._fromError(r,s)}(e,t));else if(r){const e=Jn(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t}).then(e=>{const t=e.user;return{operationType:e.operationType,credential:(n=e,Jn(n)),additionalUserInfo:rt(e),user:er.getOrCreate(t)};var n})}async function Xn(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Yn(e,n.confirm(t))}}class Zn{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Yn(Qn(this.auth),this.resolver.resolveSignIn(e))}}class er{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,i.m9)(e);return at.has(t)||at.set(t,ot._fromUser(t)),at.get(t)}(e)}static getOrCreate(e){return er.USER_MAP.has(e)||er.USER_MAP.set(e,new er(e)),er.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Yn(this.auth,Ke(this._delegate,e))}async linkWithPhoneNumber(e,t){return Xn(this.auth,async function(e,t,n){const r=(0,i.m9)(e);await qe(!1,r,"phone");const s=await Vt(r.auth,t,(0,i.m9)(n));return new Ut(s,e=>Ke(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Yn(this.auth,async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=jt(r.auth,n);return new Ht(r.auth,"linkViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Hn))}async linkWithRedirect(e){return await Gn(ue(this.auth)),function(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=jt(r.auth,n);await qe(!1,r,t.providerId),await Yt(s,r.auth);const o=await tn(r);return s._openRedirect(r.auth,t,"linkViaRedirect",o)}(e,t,n)}(this._delegate,e,Hn)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Yn(this.auth,Ge(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Xn(this.auth,async function(e,t,n){const r=(0,i.m9)(e),s=await Vt(r.auth,t,(0,i.m9)(n));return new Ut(s,e=>Ge(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Yn(this.auth,async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=jt(r.auth,n);return new Ht(r.auth,"reauthViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Hn))}async reauthenticateWithRedirect(e){return await Gn(ue(this.auth)),function(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);m(r.auth,t,Ee);const s=jt(r.auth,n);await Yt(s,r.auth);const o=await tn(r);return s._openRedirect(r.auth,t,"reauthViaRedirect",o)}(e,t,n)}(this._delegate,e,Hn)}sendEmailVerification(e){return async function(e,t){const n=(0,i.m9)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&He(n.auth,r,t);const{email:s}=await async function(e,t){return me(e,t)}(n.auth,r);s!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=(0,i.m9)(e);await qe(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return P(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=Ue(r||[]);return n.providerData=n.providerData.filter(e=>s.has(e.providerId)),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){return Je((0,i.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Je((0,i.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Ve((0,i.m9)(e),t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=(0,i.m9)(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await j(r,async function(e,t){return P(e,"POST","/v1/accounts:update",t)}(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&He(r.auth,s,n);const{email:o}=await async function(e,t){return me(e,t)}(r.auth,s);o!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}er.USER_MAP=new WeakMap;const tr=v;let nr=(()=>{class e{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;tr(n,"invalid-api-key",{appName:e.name}),tr(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?Hn:void 0;this._delegate=t.initialize({options:{persistence:ir(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(u),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?er.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=ue(e);v(r._canInitEmulator,r,"emulator-config-failed"),v(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=le(t),{host:o,port:a}=function(e){const t=le(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:de(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:de(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return P(e,"POST","/v1/accounts:update",D(e,t))}((0,i.m9)(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return Qe(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await pe((0,i.m9)(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Yn(this._delegate,async function(e,t,n){const r=ue(e),i=await xe(r,{returnSecureToken:!0,email:t,password:n}),s=await Oe._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:E()?b():"http://localhost"},{signinMethods:r}=await async function(e,t){return P(e,"POST","/v1/accounts:createAuthUri",D(e,t))}((0,i.m9)(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=_e.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(0,e)}async getRedirectResult(){tr(qn(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await ue(e)._initializationPromise,en(e,t,!1)}(this._delegate,Hn);return e?Yn(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){ue(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=rr(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=rr(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"EMAIL_SIGNIN",email:t};v(n.handleCodeInApp,r,"argument-error"),n&&He(r,s,n),await async function(e,t){return me(e,t)}(r,s)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"PASSWORD_RESET",email:t};n&&He(r,s,n),await async function(e,t){return me(e,t)}(r,s)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){zn(Object.values(Bn).includes(t),e,"invalid-persistence-type"),(0,i.b$)()?zn(t!==Bn.SESSION,e,"unsupported-persistence-type"):(0,i.UG)()?zn(t===Bn.NONE,e,"unsupported-persistence-type"):Vn()?zn(t===Bn.NONE||t===Bn.LOCAL&&(0,i.hl)(),e,"unsupported-persistence-type"):zn(t===Bn.NONE||Un(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Bn.SESSION:t=lt;break;case Bn.LOCAL:t=await _(kt)._isAvailable()?kt:ht;break;case Bn.NONE:t=H;break;default:return f("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Yn(this._delegate,async function(e){var t;const n=ue(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Oe({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await xe(n,{returnSecureToken:!0}),i=await Oe._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Yn(this._delegate,ze(this._delegate,e))}signInWithCustomToken(e){return Yn(this._delegate,async function(e,t){const n=ue(e),r=await async function(e,t){return O(e,"POST","/v1/accounts:signInWithCustomToken",D(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Oe._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return Yn(this._delegate,function(e,t,n){return ze((0,i.m9)(e),be.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Yn(this._delegate,async function(e,t,n){const r=(0,i.m9)(e),s=be.credentialWithLink(t,n||b());return v(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),ze(r,s)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Xn(this._delegate,async function(e,t,n){const r=ue(e),s=await Vt(r,t,(0,i.m9)(n));return new Ut(s,e=>ze(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return tr(qn(),this._delegate,"operation-not-supported-in-this-environment"),Yn(this._delegate,async function(e,t,n){const r=ue(e);m(e,t,Ee);const i=jt(r,n);return new Ht(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Hn))}async signInWithRedirect(e){return tr(qn(),this._delegate,"operation-not-supported-in-this-environment"),await Gn(this._delegate),function(e,t,n){return async function(e,t,n){const r=ue(e);m(e,t,Ee);const i=jt(r,n);return await Yt(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,Hn)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await Qe((0,i.m9)(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return e.Persistence=Bn,e})();function rr(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&er.getOrCreate(e)),error:t,complete:n}}function ir(e,t){const n=function(e,t){const n=$n();if(!n)return[];const r=Q(Kn,e,t);switch(n.getItem(r)){case Bn.NONE:return[H];case Bn.LOCAL:return[kt,lt];case Bn.SESSION:return[lt];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(kt)||n.push(kt),"undefined"!=typeof window)for(const r of[ht,lt])n.includes(r)||n.push(r);return n.includes(H)||n.push(H),n}class sr{constructor(){this.providerId="phone",this._delegate=new qt(Qn(r.Z.auth()))}static credential(e,t){return qt.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}sr.PHONE_SIGN_IN_METHOD=qt.PHONE_SIGN_IN_METHOD,sr.PROVIDER_ID=qt.PROVIDER_ID;const or=v;var ar;(ar=r.Z).INTERNAL.registerComponent(new c.wA("auth-compat",e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new nr(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:be,FacebookAuthProvider:Ae,GithubAuthProvider:Ce,GoogleAuthProvider:Ne,OAuthProvider:Se,SAMLAuthProvider:De,PhoneAuthProvider:sr,PhoneMultiFactorGenerator:bn,RecaptchaVerifier:class{constructor(e,t,n=r.Z.app()){var i;or(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Ft(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Pe,Auth:nr,AuthCredential:fe,Error:i.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ar.registerVersion("@firebase/auth-compat","0.2.7")},7376:(e,t,n)=>{"use strict";n.d(t,{k:()=>ng});var r=n(4762),i=n(8720),s=n(3637),o=n(7574),a=n(4402),c=n(5917),u=n(4459),h=n(9761),l=n(7393);function d(){return e=>e.lift(new f)}class f{call(e,t){return t.subscribe(new p(e))}}class p extends l.L{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}var g,m=n(8002),y=n(2145),v=n(7519),w=n(5435),I=n(8939),T=n(8583),_=(n(1390),n(156)),b=n(279),E=n(8604),k=n(9306),S=n(3854),A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N={},C=C||{},R=A||self;function D(){}function P(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function x(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var O="closure_uid_"+(1e9*Math.random()>>>0),L=0;function M(e,t,n){return e.call.apply(e.bind,arguments)}function F(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function U(e,t,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:F).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function q(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function j(){this.s=this.s,this.o=this.o}var B={};j.prototype.s=!1,j.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,O)&&e[O]||(e[O]=++L)}(this);delete B[e]}},j.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const z=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},K=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function G(e){return Array.prototype.concat.apply([],arguments)}function $(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function W(e){return/^[\s\xa0]*$/.test(e)}var H,Q=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function J(e,t){return-1!=e.indexOf(t)}function Y(e,t){return e<t?-1:e>t?1:0}e:{var X=R.navigator;if(X){var Z=X.userAgent;if(Z){H=Z;break e}}H=""}function ee(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function te(e){const t={};for(const n in e)t[n]=e[n];return t}var ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function re(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<ne.length;t++)n=ne[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ie(e){return ie[" "](e),e}ie[" "]=D;var se,oe,ae=J(H,"Opera"),ce=J(H,"Trident")||J(H,"MSIE"),ue=J(H,"Edge"),he=ue||ce,le=J(H,"Gecko")&&!(J(H.toLowerCase(),"webkit")&&!J(H,"Edge"))&&!(J(H,"Trident")||J(H,"MSIE"))&&!J(H,"Edge"),de=J(H.toLowerCase(),"webkit")&&!J(H,"Edge");function fe(){var e=R.document;return e?e.documentMode:void 0}e:{var pe="",ge=(oe=H,le?/rv:([^\);]+)(\)|;)/.exec(oe):ue?/Edge\/([\d\.]+)/.exec(oe):ce?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(oe):de?/WebKit\/(\S+)/.exec(oe):ae?/(?:Version)[ \/]?(\S+)/.exec(oe):void 0);if(ge&&(pe=ge?ge[1]:""),ce){var me=fe();if(null!=me&&me>parseFloat(pe)){se=String(me);break e}}se=pe}var ye={};var ve=R.document&&ce&&(fe()||parseInt(se,10))||void 0,we=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{R.addEventListener("test",D,t),R.removeEventListener("test",D,t)}catch(n){}return e}();function Ie(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Te(e,t){if(Ie.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(le){e:{try{ie(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:_e[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Te.Z.h.call(this)}}Ie.prototype.h=function(){this.defaultPrevented=!0},q(Te,Ie);var _e={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var be="closure_listenable_"+(1e6*Math.random()|0),Ee=0;function ke(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Ee,this.ca=this.fa=!1}function Se(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Ae(e){this.src=e,this.g={},this.h=0}function Ne(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=z(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Se(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ce(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}Ae.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Ce(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ke(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Re="closure_lm_"+(1e6*Math.random()|0),De={};function Pe(e,t,n,r,i){if(r&&r.once)return Oe(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Pe(e,t[s],n,r,i);return null}return n=je(n),e&&e[be]?e.N(t,n,x(r)?!!r.capture:!!r,i):xe(e,t,n,!1,r,i)}function xe(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=x(i)?!!i.capture:!!i,a=Ve(e);if(a||(e[Re]=a=new Ae(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=Ue;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)we||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Fe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Oe(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Oe(e,t[s],n,r,i);return null}return n=je(n),e&&e[be]?e.O(t,n,x(r)?!!r.capture:!!r,i):xe(e,t,n,!0,r,i)}function Le(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Le(e,t[s],n,r,i);else r=x(r)?!!r.capture:!!r,n=je(n),e&&e[be]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Ce(s=e.g[t],n,r,i))&&(Se(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Ve(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ce(t,n,r,i)),(n=-1<e?t[e]:null)&&Me(n))}function Me(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[be])Ne(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Fe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ve(t))?(Ne(n,e),0==n.h&&(n.src=null,t[Re]=null)):Se(e)}}}function Fe(e){return e in De?De[e]:De[e]="on"+e}function Ue(e,t){if(e.ca)e=!0;else{t=new Te(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Me(e),e=n.call(r,t)}return e}function Ve(e){return(e=e[Re])instanceof Ae?e:null}var qe="__closure_events_fn_"+(1e9*Math.random()>>>0);function je(e){return"function"==typeof e?e:(e[qe]||(e[qe]=function(t){return e.handleEvent(t)}),e[qe])}function Be(){j.call(this),this.i=new Ae(this),this.P=this,this.I=null}function ze(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Ie(t,e);else if(t instanceof Ie)t.target=t.target||e;else{var i=t;re(t=new Ie(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ke(o,r,!0,t)&&i}if(i=Ke(o=t.g=e,r,!0,t)&&i,i=Ke(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ke(o=t.g=n[s],r,!1,t)&&i}function Ke(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ne(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}q(Be,j),Be.prototype[be]=!0,Be.prototype.removeEventListener=function(e,t,n,r){Le(this,e,t,n,r)},Be.prototype.M=function(){if(Be.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Se(n[r]);delete t.g[e],t.h--}}this.I=null},Be.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Be.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ge=R.JSON.stringify;function $e(){var e=Ze;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var We,He=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Qe,e=>e.reset());class Qe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Je(e){R.setTimeout(()=>{throw e},0)}function Ye(e,t){We||function(){var e=R.Promise.resolve(void 0);We=function(){e.then(et)}}(),Xe||(We(),Xe=!0),Ze.add(e,t)}var Xe=!1,Ze=new class{constructor(){this.h=this.g=null}add(e,t){const n=He.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function et(){for(var e;e=$e();){try{e.h.call(e.g)}catch(n){Je(n)}var t=He;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Xe=!1}function tt(e,t){Be.call(this),this.h=e||1,this.g=t||R,this.j=U(this.kb,this),this.l=Date.now()}function nt(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function rt(e,t,n){if("function"==typeof e)n&&(e=U(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=U(e.handleEvent,e)}return 2147483647<Number(t)?-1:R.setTimeout(e,t||0)}function it(e){e.g=rt(()=>{e.g=null,e.i&&(e.i=!1,it(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}q(tt,Be),(g=tt.prototype).da=!1,g.S=null,g.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ze(this,"tick"),this.da&&(nt(this),this.start()))}},g.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},g.M=function(){tt.Z.M.call(this),nt(this),delete this.g};class st extends j{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:it(this)}M(){super.M(),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ot(e){j.call(this),this.h=e,this.g={}}q(ot,j);var at=[];function ct(e,t,n,r){Array.isArray(n)||(n&&(at[0]=n.toString()),n=at);for(var i=0;i<n.length;i++){var s=Pe(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ut(e){ee(e.g,function(e,t){this.g.hasOwnProperty(t)&&Me(e)},e),e.g={}}function ht(){this.g=!0}function lt(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ge(n)}catch(a){return t}}(e,n)+(r?" "+r:"")})}ot.prototype.M=function(){ot.Z.M.call(this),ut(this)},ot.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ht.prototype.Aa=function(){this.g=!1},ht.prototype.info=function(){};var dt={},ft=null;function pt(){return ft=ft||new Be}function gt(e){Ie.call(this,dt.Ma,e)}function mt(e){const t=pt();ze(t,new gt(t,e))}function yt(e,t){Ie.call(this,dt.STAT_EVENT,e),this.stat=t}function vt(e){const t=pt();ze(t,new yt(t,e))}function wt(e,t){Ie.call(this,dt.Na,e),this.size=t}function It(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){e()},t)}dt.Ma="serverreachability",q(gt,Ie),dt.STAT_EVENT="statevent",q(yt,Ie),dt.Na="timingevent",q(wt,Ie);var Tt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},_t={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function bt(){}function Et(){}bt.prototype.h=null;var kt,St={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function At(){Ie.call(this,"d")}function Nt(){Ie.call(this,"c")}function Ct(){}function Rt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new ot(this),this.P=Pt,this.W=new tt(e=he?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Dt}function Dt(){this.i=null,this.g="",this.h=!1}q(At,Ie),q(Nt,Ie),q(Ct,bt),Ct.prototype.g=function(){return new XMLHttpRequest},Ct.prototype.i=function(){return{}},kt=new Ct;var Pt=45e3,xt={},Ot={};function Lt(e,t,n){e.K=1,e.v=sn(Xt(t)),e.s=n,e.U=!0,Mt(e,null)}function Mt(e,t){e.F=Date.now(),qt(e),e.A=Xt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),vn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Dt,e.g=vr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new st(U(e.Ia,e,e.g),e.O)),ct(e.V,e.g,"readystatechange",e.gb),t=e.H?te(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),mt(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ft(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function Ut(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Vt(e,n),r==Ot){4==t&&(e.o=4,vt(14),i=!1),lt(e.j,e.m,null,"[Incomplete Response]");break}if(r==xt){e.o=4,vt(15),lt(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}lt(e.j,e.m,r,null),Gt(e,r)}Ft(e)&&r!=Ot&&r!=xt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,vt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),hr(t),t.L=!0,vt(11))):(lt(e.j,e.m,n,"[Invalid Chunked Response]"),Kt(e),zt(e))}function Vt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ot:(n=Number(t.substring(n,r)),isNaN(n)?xt:(r+=1)+n>t.length?Ot:(t=t.substr(r,n),e.C=r+n,t))}function qt(e){e.Y=Date.now()+e.P,jt(e,e.P)}function jt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=It(U(e.eb,e),t)}function Bt(e){e.B&&(R.clearTimeout(e.B),e.B=null)}function zt(e){0==e.l.G||e.I||fr(e.l,e)}function Kt(e){Bt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,nt(e.W),ut(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Gt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||En(n.i,e)))if(n.I=e.N,!e.J&&En(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;dr(n),tr(n)}ur(n),vt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=It(U(n.ab,n),6e3));if(1>=bn(n.i)&&n.ka){try{n.ka()}catch(u){}n.ka=void 0}}else gr(n,11)}else if((e.J||n.g==e)&&dr(n),!W(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(n.K=r=1.5*h,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(J(e,"spdy")||J(e,"quic")||J(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(kn(s,s.h),s.h=null))}if(r.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,rn(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=yr(r,r.H?r.la:null,r.W),o.J){Sn(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(Bt(a),qt(a)),r.g=o}else cr(r);0<n.l.length&&ir(n)}else"stop"!=u[0]&&"close"!=u[0]||gr(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?gr(n,7):er(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}mt(4)}catch(u){}}function $t(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(P(e)||"string"==typeof e)K(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(P(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(P(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Wt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Wt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ht(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Qt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Qt(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Qt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(g=Rt.prototype).setTimeout=function(e){this.P=e},g.gb=function(e){e=e.target;const t=this.L;t&&3==Qn(e)?t.l():this.Ia(e)},g.Ia=function(e){try{if(e==this.g)e:{const h=Qn(this.g);var t=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||he||this.g&&(this.h.h||this.g.ga()||Jn(this.g)))){this.I||4!=h||7==t||mt(8==t||0>=l?3:2),Bt(this);var n=this.g.ba();this.N=n;t:if(Ft(this)){var r=Jn(this.g);e="";var i=r.length,s=4==Qn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Kt(this),zt(this);var o="";break t}this.h.i=new R.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,vt(12),Kt(this),zt(this);break e}lt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Gt(this,n)}this.U?(Ut(this,h,o),he&&this.i&&3==h&&(ct(this.V,this.W,"tick",this.fb),this.W.start())):(lt(this.j,this.m,o,null),Gt(this,o)),4==h&&Kt(this),this.i&&!this.I&&(4==h?fr(this.l,this):(this.i=!1,qt(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,vt(12)):(this.o=0,vt(13)),Kt(this),zt(this)}}}catch(h){}},g.fb=function(){if(this.g){var e=Qn(this.g),t=this.g.ga();this.C<t.length&&(Bt(this),Ut(this,e,t),this.i&&4!=e&&qt(this))}},g.cancel=function(){this.I=!0,Kt(this)},g.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(mt(3),vt(17)),Kt(this),this.o=2,zt(this)):jt(this,this.Y-e)},(g=Wt.prototype).R=function(){Ht(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},g.T=function(){return Ht(this),this.g.concat()},g.get=function(e,t){return Qt(this.h,e)?this.h[e]:t},g.set=function(e,t){Qt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},g.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var Jt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Yt){this.g=void 0!==t?t:e.g,Zt(this,e.j),this.s=e.s,en(this,e.i),tn(this,e.m),this.l=e.l,t=e.h;var n=new pn;n.i=t.i,t.g&&(n.g=new Wt(t.g),n.h=t.h),nn(this,n),this.o=e.o}else e&&(n=String(e).match(Jt))?(this.g=!!t,Zt(this,n[1]||"",!0),this.s=on(n[2]||""),en(this,n[3]||"",!0),tn(this,n[4]),this.l=on(n[5]||"",!0),nn(this,n[6]||"",!0),this.o=on(n[7]||"")):(this.g=!!t,this.h=new pn(null,this.g))}function Xt(e){return new Yt(e)}function Zt(e,t,n){e.j=n?on(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function en(e,t,n){e.i=n?on(t,!0):t}function tn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function nn(e,t,n){t instanceof pn?(e.h=t,function(e,t){t&&!e.j&&(gn(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(mn(this,t),vn(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=an(t,dn)),e.h=new pn(t,e.g))}function rn(e,t,n){e.h.set(t,n)}function sn(e){return rn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function on(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function an(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,cn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function cn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Yt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(an(t,un,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(an(t,un,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(an(n,"/"==n.charAt(0)?ln:hn,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",an(n,fn)),e.join("")};var un=/[#\/\?@]/g,hn=/[#\?:]/g,ln=/[#\?]/g,dn=/[#\?@]/g,fn=/#/g;function pn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function gn(e){e.g||(e.g=new Wt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function mn(e,t){gn(e),t=wn(e,t),Qt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Qt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Ht(e)))}function yn(e,t){return gn(e),t=wn(e,t),Qt(e.g.h,t)}function vn(e,t,n){mn(e,t),0<n.length&&(e.i=null,e.g.set(wn(e,t),$(n)),e.h+=n.length)}function wn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function In(e){this.l=e||Tn,e=R.PerformanceNavigationTiming?0<(e=R.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(g=pn.prototype).add=function(e,t){gn(this),this.i=null,e=wn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},g.forEach=function(e,t){gn(this),this.g.forEach(function(n,r){K(n,function(n){e.call(t,n,r,this)},this)},this)},g.T=function(){gn(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},g.R=function(e){gn(this);var t=[];if("string"==typeof e)yn(this,e)&&(t=G(t,this.g.get(wn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=G(t,e[n])}return t},g.set=function(e,t){return gn(this),this.i=null,yn(this,e=wn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},g.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},g.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var Tn=10;function _n(e){return!!e.h||!!e.g&&e.g.size>=e.j}function bn(e){return e.h?1:e.g?e.g.size:0}function En(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function kn(e,t){e.g?e.g.add(t):e.h=t}function Sn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function An(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return $(e.i)}function Nn(){}function Cn(){this.g=new Nn}function Rn(e,t,n){const r=n||"";try{$t(e,function(e,n){let i=e;x(e)&&(i=Ge(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Dn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(s){}}function Pn(e){this.l=e.$b||null,this.j=e.ib||!1}function xn(e,t){Be.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=On,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}In.prototype.cancel=function(){if(this.i=An(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Nn.prototype.stringify=function(e){return R.JSON.stringify(e,void 0)},Nn.prototype.parse=function(e){return R.JSON.parse(e,void 0)},q(Pn,bt),Pn.prototype.g=function(){return new xn(this.l,this.j)},Pn.prototype.i=function(e){return function(){return e}}({}),q(xn,Be);var On=0;function Ln(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Mn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Fn(e)}function Fn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(g=xn.prototype).open=function(e,t){if(this.readyState!=On)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Fn(this)},g.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||R).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},g.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mn(this)),this.readyState=On},g.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==R.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ln(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},g.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mn(this):Fn(this),3==this.readyState&&Ln(this)}},g.Ua=function(e){this.g&&(this.response=this.responseText=e,Mn(this))},g.Ta=function(e){this.g&&(this.response=e,Mn(this))},g.ha=function(){this.g&&Mn(this)},g.setRequestHeader=function(e,t){this.v.append(e,t)},g.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},g.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(xn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Un=R.JSON.parse;function Vn(e){Be.call(this),this.headers=new Wt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=qn,this.K=this.L=!1}q(Vn,Be);var qn="",jn=/^https?$/i,Bn=["POST","PUT"];function zn(e){return"content-type"==e.toLowerCase()}function Kn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Gn(e),Wn(e)}function Gn(e){e.D||(e.D=!0,ze(e,"complete"),ze(e,"error"))}function $n(e){if(e.h&&void 0!==C&&(!e.C[1]||4!=Qn(e)||2!=e.ba()))if(e.v&&4==Qn(e))rt(e.Fa,0,e);else if(ze(e,"readystatechange"),4==Qn(e)){e.h=!1;try{const c=e.ba();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===c){var i=String(e.H).match(Jt)[1]||null;if(!i&&R.self&&R.self.location){var s=R.self.location.protocol;i=s.substr(0,s.length-1)}r=!jn.test(i?i.toLowerCase():"")}n=r}if(n)ze(e,"complete"),ze(e,"success");else{e.m=6;try{var o=2<Qn(e)?e.g.statusText:""}catch(a){o=""}e.j=o+" ["+e.ba()+"]",Gn(e)}}finally{Wn(e)}}}function Wn(e,t){if(e.g){Hn(e);const r=e.g,i=e.C[0]?D:null;e.g=null,e.C=null,t||ze(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function Hn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(R.clearTimeout(e.A),e.A=null)}function Qn(e){return e.g?e.g.readyState:0}function Jn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case qn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Yn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return ee(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):rn(e,t,n))}function Xn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Zn(e){this.za=0,this.l=[],this.h=new ht,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Xn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Xn("baseRetryDelayMs",5e3,e),this.$a=Xn("retryDelaySeedMs",1e4,e),this.Ya=Xn("forwardChannelMaxRetries",2,e),this.ra=Xn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new In(e&&e.concurrentRequestLimit),this.Ca=new Cn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function er(e){if(nr(e),3==e.G){var t=e.V++,n=Xt(e.F);rn(n,"SID",e.J),rn(n,"RID",t),rn(n,"TYPE","terminate"),or(e,n),(t=new Rt(e,e.h,t,void 0)).K=2,t.v=sn(Xt(n)),n=!1,R.navigator&&R.navigator.sendBeacon&&(n=R.navigator.sendBeacon(t.v.toString(),"")),!n&&R.Image&&((new Image).src=t.v,n=!0),n||(t.g=vr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),qt(t)}mr(e)}function tr(e){e.g&&(hr(e),e.g.cancel(),e.g=null)}function nr(e){tr(e),e.u&&(R.clearTimeout(e.u),e.u=null),dr(e),e.i.cancel(),e.m&&("number"==typeof e.m&&R.clearTimeout(e.m),e.m=null)}function rr(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&ir(e)}function ir(e){_n(e.i)||e.m||(e.m=!0,Ye(e.Ha,e),e.C=0)}function sr(e,t){var n;n=t?t.m:e.V++;const r=Xt(e.F);rn(r,"SID",e.J),rn(r,"RID",n),rn(r,"AID",e.U),or(e,r),e.o&&e.s&&Yn(r,e.o,e.s),n=new Rt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=ar(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),kn(e.i,n),Lt(n,r,t)}function or(e,t){e.j&&$t({},function(e,n){rn(t,n,e)})}function ar(e,t,n){n=Math.min(e.l.length,n);var r=e.j?U(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{Rn(a,e,"req"+n+"_")}catch(Qr){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function cr(e){e.g||e.u||(e.Y=1,Ye(e.Ga,e),e.A=0)}function ur(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=It(U(e.Ga,e),pr(e,e.A)),e.A++,0))}function hr(e){null!=e.B&&(R.clearTimeout(e.B),e.B=null)}function lr(e){e.g=new Rt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Xt(e.oa);rn(t,"RID","rpc"),rn(t,"SID",e.J),rn(t,"CI",e.N?"0":"1"),rn(t,"AID",e.U),or(e,t),rn(t,"TYPE","xmlhttp"),e.o&&e.s&&Yn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=sn(Xt(t)),n.s=null,n.U=!0,Mt(n,e)}function dr(e){null!=e.v&&(R.clearTimeout(e.v),e.v=null)}function fr(e,t){var n=null;if(e.g==t){dr(e),hr(e),e.g=null;var r=2}else{if(!En(e.i,t))return;n=t.D,Sn(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;ze(r=pt(),new wt(r,n,t,i)),ir(e)}else cr(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(bn(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=It(U(e.Ha,e,t),pr(e,e.C)),e.C++,0)))}(e,t)||2==r&&ur(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:gr(e,5);break;case 4:gr(e,10);break;case 3:gr(e,6);break;default:gr(e,2)}}function pr(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function gr(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=U(e.jb,e);n||(n=new Yt("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||Zt(n,"https"),sn(n)),function(e,t){const n=new ht;if(R.Image){const r=new Image;r.onload=V(Dn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=V(Dn,n,r,"TestLoadImage: error",!1,t),r.onabort=V(Dn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=V(Dn,n,r,"TestLoadImage: timeout",!1,t),R.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else vt(2);e.G=0,e.j&&e.j.va(t),mr(e),nr(e)}function mr(e){e.G=0,e.I=-1,e.j&&(0==An(e.i).length&&0==e.l.length||(e.i.i.length=0,$(e.l),e.l.length=0),e.j.ua())}function yr(e,t,n){let r=function(e){return e instanceof Yt?Xt(e):new Yt(e,void 0)}(n);if(""!=r.i)t&&en(r,t+"."+r.i),tn(r,r.m);else{const e=R.location;r=function(e,t,n,r){var i=new Yt(null,void 0);return e&&Zt(i,e),t&&en(i,t),n&&tn(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&ee(e.aa,function(e,t){rn(r,t,e)}),n=e.sa,(t=e.D)&&n&&rn(r,t,n),rn(r,"VER",e.ma),or(e,r),r}function vr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Vn(n&&e.Ba&&!e.qa?new Pn({ib:!0}):e.qa)).L=e.H,t}function wr(){}function Ir(){if(ce&&!(10<=Number(ve)))throw Error("Environmental error: no available transport.")}function Tr(e,t){Be.call(this),this.g=new Zn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!W(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!W(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Er(this)}function _r(e){At.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function br(){Nt.call(this),this.status=1}function Er(e){this.g=e}(g=Vn.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():kt.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:kt),this.g.onreadystatechange=U(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Kn(this,s)}e=n||"";const i=new Wt(this.headers);r&&$t(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=zn;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=R.FormData&&e instanceof R.FormData,!(0<=z(Bn,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Hn(this),0<this.B&&((this.K=function(e){return ce&&function(){return e=ye,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=Q(String(se)).split("."),n=Q("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Y(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==i[2].length,0==s[2].length)||Y(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=U(this.pa,this)):this.A=rt(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Kn(this,s)}},g.pa=function(){void 0!==C&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ze(this,"timeout"),this.abort(8))},g.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ze(this,"complete"),ze(this,"abort"),Wn(this))},g.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Wn(this,!0)),Vn.Z.M.call(this)},g.Fa=function(){this.s||(this.F||this.v||this.l?$n(this):this.cb())},g.cb=function(){$n(this)},g.ba=function(){try{return 2<Qn(this)?this.g.status:-1}catch(oe){return-1}},g.ga=function(){try{return this.g?this.g.responseText:""}catch(oe){return""}},g.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Un(t)}},g.Da=function(){return this.m},g.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(g=Zn.prototype).ma=8,g.G=1,g.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},g.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Rt(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=te(s),re(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ar(this,i,t),rn(n=Xt(this.F),"RID",e),rn(n,"CVER",22),this.D&&rn(n,"X-HTTP-Session-Id",this.D),or(this,n),this.o&&s&&Yn(n,this.o,s),kn(this.i,i),this.Ra&&rn(n,"TYPE","init"),this.ja?(rn(n,"$req",t),rn(n,"SID","null"),i.$=!0,Lt(i,n,null)):Lt(i,n,t),this.G=2}}else 3==this.G&&(e?sr(this,e):0==this.l.length||_n(this.i)||sr(this))},g.Ga=function(){if(this.u=null,lr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=It(U(this.bb,this),e)}},g.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,vt(10),tr(this),lr(this))},g.ab=function(){null!=this.v&&(this.v=null,tr(this),ur(this),vt(19))},g.jb=function(e){e?(this.h.info("Successfully pinged google.com"),vt(2)):(this.h.info("Failed to ping google.com"),vt(1))},(g=wr.prototype).xa=function(){},g.wa=function(){},g.va=function(){},g.ua=function(){},g.Oa=function(){},Ir.prototype.g=function(e,t){return new Tr(e,t)},q(Tr,Be),Tr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Ye(U(e.hb,e,t))),vt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=yr(e,null,e.W),ir(e)},Tr.prototype.close=function(){er(this.g)},Tr.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,rr(this.g,t)}else this.v?((t={}).__data__=Ge(e),rr(this.g,t)):rr(this.g,e)},Tr.prototype.M=function(){this.g.j=null,delete this.j,er(this.g),delete this.g,Tr.Z.M.call(this)},q(_r,At),q(br,Nt),q(Er,wr),Er.prototype.xa=function(){ze(this.g,"a")},Er.prototype.wa=function(e){ze(this.g,new _r(e))},Er.prototype.va=function(e){ze(this.g,new br(e))},Er.prototype.ua=function(){ze(this.g,"b")},Ir.prototype.createWebChannel=Ir.prototype.g,Tr.prototype.send=Tr.prototype.u,Tr.prototype.open=Tr.prototype.m,Tr.prototype.close=Tr.prototype.close,Tt.NO_ERROR=0,Tt.TIMEOUT=8,Tt.HTTP_ERROR=6,_t.COMPLETE="complete",Et.EventType=St,St.OPEN="a",St.CLOSE="b",St.ERROR="c",St.MESSAGE="d",Be.prototype.listen=Be.prototype.N,Vn.prototype.listenOnce=Vn.prototype.O,Vn.prototype.getLastError=Vn.prototype.La,Vn.prototype.getLastErrorCode=Vn.prototype.Da,Vn.prototype.getStatus=Vn.prototype.ba,Vn.prototype.getResponseJson=Vn.prototype.Qa,Vn.prototype.getResponseText=Vn.prototype.ga,Vn.prototype.send=Vn.prototype.ea;var kr=N.createWebChannelTransport=function(){return new Ir},Sr=N.getStatEventTarget=function(){return pt()},Ar=N.ErrorCode=Tt,Nr=N.EventType=_t,Cr=N.Event=dt,Rr=N.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Dr=N.FetchXmlHttpFactory=Pn,Pr=N.WebChannel=Et,xr=N.XhrIo=Vn;const Or="@firebase/firestore";class Lr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lr.UNAUTHENTICATED=new Lr(null),Lr.GOOGLE_CREDENTIALS=new Lr("google-credentials-uid"),Lr.FIRST_PARTY=new Lr("first-party-uid"),Lr.MOCK_USER=new Lr("mock-user");let Mr="9.6.5";const Fr=new k.Yd("@firebase/firestore");function Ur(){return Fr.logLevel}function Vr(e,...t){if(Fr.logLevel<=k.in.DEBUG){const n=t.map(Br);Fr.debug(`Firestore (${Mr}): ${e}`,...n)}}function qr(e,...t){if(Fr.logLevel<=k.in.ERROR){const n=t.map(Br);Fr.error(`Firestore (${Mr}): ${e}`,...n)}}function jr(e,...t){if(Fr.logLevel<=k.in.WARN){const n=t.map(Br);Fr.warn(`Firestore (${Mr}): ${e}`,...n)}}function Br(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function zr(e="Unexpected state"){const t=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+e;throw qr(t),new Error(t)}function Kr(e,t){e||zr()}function Gr(e,t){return e}const $r={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Wr extends S.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Hr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Qr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Jr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Lr.UNAUTHENTICATED))}shutdown(){}}class Yr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Xr{constructor(e){this.t=e,this.currentUser=Lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Hr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Hr,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{Vr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Vr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Hr)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Vr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Kr("string"==typeof t.accessToken),new Qr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Kr(null===e||"string"==typeof e),new Lr(e)}}class Zr{constructor(e,t,n){this.type="FirstParty",this.user=Lr.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class ei{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Zr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Lr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ti{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ni{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable(()=>(e=>(null!=e.error&&Vr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token)))(n))};const n=e=>{Vr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):Vr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Kr("string"==typeof e.token),new ti(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class ri{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function ii(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}ri.I=-1;class si{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=ii(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function oi(e,t){return e<t?-1:e>t?1:0}function ai(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function ci(e){return e+"\0"}class ui{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Wr($r.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Wr($r.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Wr($r.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Wr($r.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ui.fromMillis(Date.now())}static fromDate(e){return ui.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ui(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?oi(this.nanoseconds,e.nanoseconds):oi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class hi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new hi(e)}static min(){return new hi(new ui(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function li(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function di(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function fi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class pi{constructor(e,t,n){void 0===t?t=0:t>e.length&&zr(),void 0===n?n=e.length-t:n>e.length-t&&zr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===pi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof pi?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class gi extends pi{construct(e,t,n){return new gi(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Wr($r.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new gi(t)}static emptyPath(){return new gi([])}}const mi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class yi extends pi{construct(e,t,n){return new yi(e,t,n)}static isValidIdentifier(e){return mi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),yi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new yi(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Wr($r.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Wr($r.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Wr($r.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Wr($r.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new yi(t)}static emptyPath(){return new yi([])}}class vi{constructor(e){this.fields=e,e.sort(yi.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ai(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class wi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new wi(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new wi(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return oi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}wi.EMPTY_BYTE_STRING=new wi("");const Ii=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(e){if(Kr(!!e),"string"==typeof e){let t=0;const n=Ii.exec(e);if(Kr(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:_i(e.seconds),nanos:_i(e.nanos)}}function _i(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function bi(e){return"string"==typeof e?wi.fromBase64String(e):wi.fromUint8Array(e)}function Ei(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ki(e){const t=e.mapValue.fields.__previous_value__;return Ei(t)?ki(t):t}function Si(e){const t=Ti(e.mapValue.fields.__local_write_time__.timestampValue);return new ui(t.seconds,t.nanos)}function Ai(e){return null==e}function Ni(e){return 0===e&&1/e==-1/0}function Ci(e){return"number"==typeof e&&Number.isInteger(e)&&!Ni(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Ri{constructor(e){this.path=e}static fromPath(e){return new Ri(gi.fromString(e))}static fromName(e){return new Ri(gi.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===gi.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return gi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ri(new gi(e.slice()))}}function Di(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ei(e)?4:10:zr()}function Pi(e,t){if(e===t)return!0;const n=Di(e);if(n!==Di(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Si(e).isEqual(Si(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ti(e.timestampValue),r=Ti(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return bi(e.bytesValue).isEqual(bi(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return _i(e.geoPointValue.latitude)===_i(t.geoPointValue.latitude)&&_i(e.geoPointValue.longitude)===_i(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return _i(e.integerValue)===_i(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=_i(e.doubleValue),r=_i(t.doubleValue);return n===r?Ni(n)===Ni(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ai(e.arrayValue.values||[],t.arrayValue.values||[],Pi);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(li(n)!==li(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Pi(n[i],r[i])))return!1;return!0}(e,t);default:return zr()}}function xi(e,t){return void 0!==(e.values||[]).find(e=>Pi(e,t))}function Oi(e,t){if(e===t)return 0;const n=Di(e),r=Di(t);if(n!==r)return oi(n,r);switch(n){case 0:return 0;case 1:return oi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=_i(e.integerValue||e.doubleValue),r=_i(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Li(e.timestampValue,t.timestampValue);case 4:return Li(Si(e),Si(t));case 5:return oi(e.stringValue,t.stringValue);case 6:return function(e,t){const n=bi(e),r=bi(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=oi(n[i],r[i]);if(0!==e)return e}return oi(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=oi(_i(e.latitude),_i(t.latitude));return 0!==n?n:oi(_i(e.longitude),_i(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Oi(n[i],r[i]);if(e)return e}return oi(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=oi(r[o],s[o]);if(0!==e)return e;const t=Oi(n[r[o]],i[s[o]]);if(0!==t)return t}return oi(r.length,s.length)}(e.mapValue,t.mapValue);default:throw zr()}}function Li(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return oi(e,t);const n=Ti(e),r=Ti(t),i=oi(n.seconds,r.seconds);return 0!==i?i:oi(n.nanos,r.nanos)}function Mi(e){return Fi(e)}function Fi(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ti(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?bi(e.bytesValue).toBase64():"referenceValue"in e?Ri.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Fi(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Fi(e.fields[i])}`;return n+"}"}(e.mapValue):zr();var t}function Ui(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Vi(e){return!!e&&"integerValue"in e}function qi(e){return!!e&&"arrayValue"in e}function ji(e){return!!e&&"nullValue"in e}function Bi(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function zi(e){return!!e&&"mapValue"in e}function Ki(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return di(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Ki(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ki(e.arrayValue.values[n]);return t}return Object.assign({},e)}class Gi{constructor(e){this.value=e}static empty(){return new Gi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!zi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ki(t)}setAll(e){let t=yi.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Ki(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());zi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];zi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){di(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new Gi(Ki(this.value))}}function $i(e){const t=[];return di(e.fields,(e,n)=>{const r=new yi([e]);if(zi(n)){const e=$i(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new vi(t)}class Wi{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new Wi(e,0,hi.min(),Gi.empty(),0)}static newFoundDocument(e,t,n){return new Wi(e,1,t,n,0)}static newNoDocument(e,t){return new Wi(e,2,t,Gi.empty(),0)}static newUnknownDocument(e,t){return new Wi(e,3,t,Gi.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Gi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Gi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Wi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Wi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Hi{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function Qi(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Hi(e,t,n,r,i,s,o)}function Ji(e){const t=Gr(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+Mi(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ai(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=us(t.startAt)),t.endAt&&(e+="|ub:",e+=us(t.endAt)),t.R=e}return t.R}function Yi(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!ls(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!Pi(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!fs(e.startAt,t.startAt)&&fs(e.endAt,t.endAt)}function Xi(e){return Ri.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Zi extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new es(e,t,n):"array-contains"===t?new is(e,n):"in"===t?new ss(e,n):"not-in"===t?new os(e,n):"array-contains-any"===t?new as(e,n):new Zi(e,t,n)}static P(e,t,n){return"in"===t?new ts(e,n):new ns(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Oi(t,this.value)):null!==t&&Di(this.value)===Di(t)&&this.v(Oi(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return zr()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class es extends Zi{constructor(e,t,n){super(e,t,n),this.key=Ri.fromName(n.referenceValue)}matches(e){const t=Ri.comparator(e.key,this.key);return this.v(t)}}class ts extends Zi{constructor(e,t){super(e,"in",t),this.keys=rs(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ns extends Zi{constructor(e,t){super(e,"not-in",t),this.keys=rs(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rs(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Ri.fromName(e.referenceValue))}class is extends Zi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qi(t)&&xi(t.arrayValue,this.value)}}class ss extends Zi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&xi(this.value.arrayValue,t)}}class os extends Zi{constructor(e,t){super(e,"not-in",t)}matches(e){if(xi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!xi(this.value.arrayValue,t)}}class as extends Zi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>xi(this.value.arrayValue,e))}}class cs{constructor(e,t){this.position=e,this.before=t}}function us(e){return`${e.before?"b":"a"}:${e.position.map(e=>Mi(e)).join(",")}`}class hs{constructor(e,t="asc"){this.field=e,this.dir=t}}function ls(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ds(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Ri.comparator(Ri.fromName(o.referenceValue),n.key):Oi(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function fs(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Pi(e.position[n],t.position[n]))return!1;return!0}class ps{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null}}function gs(e,t,n,r,i,s,o,a){return new ps(e,t,n,r,i,s,o,a)}function ms(e){return new ps(e)}function ys(e){return!Ai(e.limit)&&"F"===e.limitType}function vs(e){return!Ai(e.limit)&&"L"===e.limitType}function ws(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Is(e){for(const t of e.filters)if(t.V())return t.field;return null}function Ts(e){return null!==e.collectionGroup}function _s(e){const t=Gr(e);if(null===t.S){t.S=[];const e=Is(t),n=ws(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new hs(e)),t.S.push(new hs(yi.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new hs(yi.keyField(),e))}}}return t.S}function bs(e){const t=Gr(e);if(!t.D)if("F"===t.limitType)t.D=Qi(t.path,t.collectionGroup,_s(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of _s(t))e.push(new hs(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new cs(t.endAt.position,!t.endAt.before):null,r=t.startAt?new cs(t.startAt.position,!t.startAt.before):null;t.D=Qi(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function Es(e,t,n){return new ps(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ks(e,t){return Yi(bs(e),bs(t))&&e.limitType===t.limitType}function Ss(e){return`${Ji(bs(e))}|lt:${e.limitType}`}function As(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Mi(t.value)}`;var t}).join(", ")}]`),Ai(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+us(e.startAt)),e.endAt&&(t+=", endAt: "+us(e.endAt)),`Target(${t})`}(bs(e))}; limitType=${e.limitType})`}function Ns(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ri.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!ds(e.startAt,_s(e),t)||e.endAt&&ds(e.endAt,_s(e),t))}(e,t)}function Cs(e){return(t,n)=>{let r=!1;for(const i of _s(e)){const e=Rs(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Rs(e,t,n){const r=e.field.isKeyField()?Ri.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Oi(r,i):zr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return zr()}}function Ds(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ni(t)?"-0":t}}function Ps(e){return{integerValue:""+e}}function xs(e,t){return Ci(t)?Ps(t):Ds(e,t)}class Os{constructor(){this._=void 0}}function Ls(e,t,n){return e instanceof Us?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Vs?qs(e,t):e instanceof js?Bs(e,t):function(e,t){const n=Fs(e,t),r=Ks(n)+Ks(e.N);return Vi(n)&&Vi(e.N)?Ps(r):Ds(e.k,r)}(e,t)}function Ms(e,t,n){return e instanceof Vs?qs(e,t):e instanceof js?Bs(e,t):n}function Fs(e,t){return e instanceof zs?Vi(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Us extends Os{}class Vs extends Os{constructor(e){super(),this.elements=e}}function qs(e,t){const n=Gs(t);for(const r of e.elements)n.some(e=>Pi(e,r))||n.push(r);return{arrayValue:{values:n}}}class js extends Os{constructor(e){super(),this.elements=e}}function Bs(e,t){let n=Gs(t);for(const r of e.elements)n=n.filter(e=>!Pi(e,r));return{arrayValue:{values:n}}}class zs extends Os{constructor(e,t){super(),this.k=e,this.N=t}}function Ks(e){return _i(e.integerValue||e.doubleValue)}function Gs(e){return qi(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class $s{constructor(e,t){this.field=e,this.transform=t}}class Ws{constructor(e,t){this.version=e,this.transformResults=t}}class Hs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Hs}static exists(e){return new Hs(void 0,e)}static updateTime(e){return new Hs(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Qs(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Js{}function Ys(e,t,n){e instanceof no?function(e,t,n){const r=e.value.clone(),i=so(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ro?function(e,t,n){if(!Qs(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=so(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(io(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Xs(e,t,n){e instanceof no?function(e,t,n){if(!Qs(e.precondition,t))return;const r=e.value.clone(),i=oo(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(to(t),r).setHasLocalMutations()}(e,t,n):e instanceof ro?function(e,t,n){if(!Qs(e.precondition,t))return;const r=oo(e.fieldTransforms,n,t),i=t.data;i.setAll(io(e)),i.setAll(r),t.convertToFoundDocument(to(t),i).setHasLocalMutations()}(e,t,n):function(e,t){Qs(e.precondition,t)&&t.convertToNoDocument(hi.min())}(e,t)}function Zs(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Fs(r.transform,e||null);null!=i&&(null==n&&(n=Gi.empty()),n.set(r.field,i))}return n||null}function eo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ai(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Vs&&t instanceof Vs||e instanceof js&&t instanceof js?ai(e.elements,t.elements,Pi):e instanceof zs&&t instanceof zs?Pi(e.N,t.N):e instanceof Us&&t instanceof Us}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function to(e){return e.isFoundDocument()?e.version:hi.min()}class no extends Js{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class ro extends Js{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function io(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function so(e,t,n){const r=new Map;Kr(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Ms(o,a,n[i]))}return r}function oo(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ls(e,s,t))}return r}class ao extends Js{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class co extends Js{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class uo{constructor(e){this.count=e}}var ho,lo;function fo(e){switch(e){default:return zr();case $r.CANCELLED:case $r.UNKNOWN:case $r.DEADLINE_EXCEEDED:case $r.RESOURCE_EXHAUSTED:case $r.INTERNAL:case $r.UNAVAILABLE:case $r.UNAUTHENTICATED:return!1;case $r.INVALID_ARGUMENT:case $r.NOT_FOUND:case $r.ALREADY_EXISTS:case $r.PERMISSION_DENIED:case $r.FAILED_PRECONDITION:case $r.ABORTED:case $r.OUT_OF_RANGE:case $r.UNIMPLEMENTED:case $r.DATA_LOSS:return!0}}function po(e){if(void 0===e)return qr("GRPC error has no .code"),$r.UNKNOWN;switch(e){case ho.OK:return $r.OK;case ho.CANCELLED:return $r.CANCELLED;case ho.UNKNOWN:return $r.UNKNOWN;case ho.DEADLINE_EXCEEDED:return $r.DEADLINE_EXCEEDED;case ho.RESOURCE_EXHAUSTED:return $r.RESOURCE_EXHAUSTED;case ho.INTERNAL:return $r.INTERNAL;case ho.UNAVAILABLE:return $r.UNAVAILABLE;case ho.UNAUTHENTICATED:return $r.UNAUTHENTICATED;case ho.INVALID_ARGUMENT:return $r.INVALID_ARGUMENT;case ho.NOT_FOUND:return $r.NOT_FOUND;case ho.ALREADY_EXISTS:return $r.ALREADY_EXISTS;case ho.PERMISSION_DENIED:return $r.PERMISSION_DENIED;case ho.FAILED_PRECONDITION:return $r.FAILED_PRECONDITION;case ho.ABORTED:return $r.ABORTED;case ho.OUT_OF_RANGE:return $r.OUT_OF_RANGE;case ho.UNIMPLEMENTED:return $r.UNIMPLEMENTED;case ho.DATA_LOSS:return $r.DATA_LOSS;default:return zr()}}(lo=ho||(ho={}))[lo.OK=0]="OK",lo[lo.CANCELLED=1]="CANCELLED",lo[lo.UNKNOWN=2]="UNKNOWN",lo[lo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",lo[lo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",lo[lo.NOT_FOUND=5]="NOT_FOUND",lo[lo.ALREADY_EXISTS=6]="ALREADY_EXISTS",lo[lo.PERMISSION_DENIED=7]="PERMISSION_DENIED",lo[lo.UNAUTHENTICATED=16]="UNAUTHENTICATED",lo[lo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",lo[lo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",lo[lo.ABORTED=10]="ABORTED",lo[lo.OUT_OF_RANGE=11]="OUT_OF_RANGE",lo[lo.UNIMPLEMENTED=12]="UNIMPLEMENTED",lo[lo.INTERNAL=13]="INTERNAL",lo[lo.UNAVAILABLE=14]="UNAVAILABLE",lo[lo.DATA_LOSS=15]="DATA_LOSS";class go{constructor(e,t){this.comparator=e,this.root=t||yo.EMPTY}insert(e,t){return new go(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,yo.BLACK,null,null))}remove(e){return new go(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new mo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new mo(this.root,e,this.comparator,!1)}getReverseIterator(){return new mo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new mo(this.root,e,this.comparator,!0)}}class mo{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class yo{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:yo.RED,this.left=null!=r?r:yo.EMPTY,this.right=null!=i?i:yo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new yo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return yo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return yo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,yo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,yo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw zr();if(this.right.isRed())throw zr();const e=this.left.check();if(e!==this.right.check())throw zr();return e+(this.isRed()?0:1)}}yo.EMPTY=null,yo.RED=!0,yo.BLACK=!1,yo.EMPTY=new class{constructor(){this.size=0}get key(){throw zr()}get value(){throw zr()}get color(){throw zr()}get left(){throw zr()}get right(){throw zr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new yo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vo{constructor(e){this.comparator=e,this.data=new go(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new wo(this.data.getIterator())}getIteratorFrom(e){return new wo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof vo))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new vo(this.comparator);return t.data=e,t}}class wo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const Io=new go(Ri.comparator);function To(){return Io}const _o=new go(Ri.comparator);function bo(){return _o}const Eo=new go(Ri.comparator);function ko(){return Eo}const So=new vo(Ri.comparator);function Ao(...e){let t=So;for(const n of e)t=t.add(n);return t}const No=new vo(oi);function Co(){return No}class Ro{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Do.createSynthesizedTargetChangeForCurrentChange(e,t)),new Ro(hi.min(),n,Co(),To(),Ao())}}class Do{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Do(wi.EMPTY_BYTE_STRING,t,Ao(),Ao(),Ao())}}class Po{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class xo{constructor(e,t){this.targetId=e,this.M=t}}class Oo{constructor(e,t,n=wi.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Lo{constructor(){this.F=0,this.L=Uo(),this.B=wi.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=Ao(),t=Ao(),n=Ao();return this.L.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:zr()}}),new Do(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=Uo()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class Mo{constructor(e){this.et=e,this.nt=new Map,this.st=To(),this.it=Fo(),this.rt=new vo(oi)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:zr()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((e,n)=>{this.lt(n)&&t(n)})}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(Xi(e))if(0===n){const n=new Ri(e.path);this.at(t,n,Wi.newNoDocument(n,hi.min()))}else Kr(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((n,r)=>{const i=this.wt(r);if(i){if(n.current&&Xi(i.target)){const t=new Ri(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,Wi.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}});let n=Ao();this.it.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))});const r=new Ro(e,t,this.rt,this.st,n);return this.st=To(),this.it=Fo(),this.rt=new vo(oi),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new Lo,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new vo(oi),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||Vr("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new Lo),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function Fo(){return new go(Ri.comparator)}function Uo(){return new go(Ri.comparator)}const Vo={asc:"ASCENDING",desc:"DESCENDING"},qo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class jo{constructor(e,t){this.databaseId=e,this.C=t}}function Bo(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function zo(e,t){return e.C?t.toBase64():t.toUint8Array()}function Ko(e,t){return Bo(e,t.toTimestamp())}function Go(e){return Kr(!!e),hi.fromTimestamp(function(e){const t=Ti(e);return new ui(t.seconds,t.nanos)}(e))}function $o(e,t){return function(e){return new gi(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Wo(e){const t=gi.fromString(e);return Kr(ya(t)),t}function Ho(e,t){return $o(e.databaseId,t.path)}function Qo(e,t){const n=Wo(t);if(n.get(1)!==e.databaseId.projectId)throw new Wr($r.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Wr($r.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ri(Zo(n))}function Jo(e,t){return $o(e.databaseId,t)}function Yo(e){const t=Wo(e);return 4===t.length?gi.emptyPath():Zo(t)}function Xo(e){return new gi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Zo(e){return Kr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ea(e,t,n){return{name:Ho(e,t),fields:n.value.mapValue.fields}}function ta(e,t,n){const r=Qo(e,t.name),i=Go(t.updateTime),s=new Gi({mapValue:{fields:t.fields}}),o=Wi.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function na(e,t){let n;if(t instanceof no)n={update:ea(e,t.key,t.value)};else if(t instanceof ao)n={delete:Ho(e,t.key)};else if(t instanceof ro)n={update:ea(e,t.key,t.data),updateMask:ma(t.fieldMask)};else{if(!(t instanceof co))return zr();n={verify:Ho(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Us)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vs)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof js)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof zs)return{fieldPath:t.field.canonicalString(),increment:n.N};throw zr()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ko(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zr()}(e,t.precondition)),n}function ra(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Hs.updateTime(Go(e.updateTime)):void 0!==e.exists?Hs.exists(e.exists):Hs.none()}(t.currentDocument):Hs.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;"setToServerValue"in t?(Kr("REQUEST_TIME"===t.setToServerValue),n=new Us):"appendMissingElements"in t?n=new Vs(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new js(t.removeAllFromArray.values||[]):"increment"in t?n=new zs(e,t.increment):zr();const r=yi.fromServerFormat(t.fieldPath);return new $s(r,n)}(e,t)):[];if(t.update){const i=Qo(e,t.update.name),s=new Gi({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){return new vi((e.fieldPaths||[]).map(e=>yi.fromServerFormat(e)))}(t.updateMask);return new ro(i,s,e,n,r)}return new no(i,s,n,r)}if(t.delete){const r=Qo(e,t.delete);return new ao(r,n)}if(t.verify){const r=Qo(e,t.verify);return new co(r,n)}return zr()}function ia(e,t){return{documents:[Jo(e,t.path)]}}function sa(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Jo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Jo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(Bi(e.value))return{unaryFilter:{field:da(e.field),op:"IS_NAN"}};if(ji(e.value))return{unaryFilter:{field:da(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Bi(e.value))return{unaryFilter:{field:da(e.field),op:"IS_NOT_NAN"}};if(ji(e.value))return{unaryFilter:{field:da(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:da(e.field),op:la(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:da(e.field),direction:ha(e.dir)}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.C||Ai(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=ca(t.startAt)),t.endAt&&(n.structuredQuery.endAt=ca(t.endAt)),n}function oa(e){let t=Yo(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Kr(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=aa(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new hs(fa(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ai(t)?null:t}(n.limit));let c=null;n.startAt&&(c=ua(n.startAt));let u=null;return n.endAt&&(u=ua(n.endAt)),gs(t,i,o,s,a,"F",c,u)}function aa(e){return e?void 0!==e.unaryFilter?[ga(e)]:void 0!==e.fieldFilter?[pa(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>aa(e)).reduce((e,t)=>e.concat(t)):zr():[]}function ca(e){return{before:e.before,values:e.position}}function ua(e){return new cs(e.values||[],!!e.before)}function ha(e){return Vo[e]}function la(e){return qo[e]}function da(e){return{fieldPath:e.canonicalString()}}function fa(e){return yi.fromServerFormat(e.fieldPath)}function pa(e){return Zi.create(fa(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return zr()}}(e.fieldFilter.op),e.fieldFilter.value)}function ga(e){switch(e.unaryFilter.op){case"IS_NAN":const t=fa(e.unaryFilter.field);return Zi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=fa(e.unaryFilter.field);return Zi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=fa(e.unaryFilter.field);return Zi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=fa(e.unaryFilter.field);return Zi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return zr()}}function ma(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ya(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function va(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ia(t)),t=wa(e.get(n),t);return Ia(t)}function wa(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function Ia(e){return e+"\x01\x01"}function Ta(e){const t=e.length;if(Kr(t>=2),2===t)return Kr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),gi.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("\x01",s);switch((t<0||t>n)&&zr(),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:zr()}s=t+2}return new gi(r)}class _a{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class ba{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}ba.store="owner",ba.key="owner";class Ea{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}Ea.store="mutationQueues",Ea.keyPath="userId";class ka{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}ka.store="mutations",ka.keyPath="batchId",ka.userMutationsIndex="userMutationsIndex",ka.userMutationsKeyPath=["userId","batchId"];class Sa{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,va(t)]}static key(e,t,n){return[e,va(t),n]}}Sa.store="documentMutations",Sa.PLACEHOLDER=new Sa;class Aa{constructor(e,t){this.path=e,this.readTime=t}}class Na{constructor(e,t){this.path=e,this.version=t}}class Ca{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}Ca.store="remoteDocuments",Ca.readTimeIndex="readTimeIndex",Ca.readTimeIndexPath="readTime",Ca.collectionReadTimeIndex="collectionReadTimeIndex",Ca.collectionReadTimeIndexPath=["parentPath","readTime"];class Ra{constructor(e){this.byteSize=e}}Ra.store="remoteDocumentGlobal",Ra.key="remoteDocumentGlobalKey";class Da{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}Da.store="targets",Da.keyPath="targetId",Da.queryTargetsIndexName="queryTargetsIndex",Da.queryTargetsKeyPath=["canonicalId","targetId"];class Pa{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}Pa.store="targetDocuments",Pa.keyPath=["targetId","path"],Pa.documentTargetsIndex="documentTargetsIndex",Pa.documentTargetsKeyPath=["path","targetId"];class xa{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}xa.key="targetGlobalKey",xa.store="targetGlobal";class Oa{constructor(e,t){this.collectionId=e,this.parent=t}}Oa.store="collectionParents",Oa.keyPath=["collectionId","parent"];class La{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}La.store="clientMetadata",La.keyPath="clientId";class Ma{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}Ma.store="bundles",Ma.keyPath="bundleId";class Fa{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}Fa.store="namedQueries",Fa.keyPath="name";const Ua=[Ea.store,ka.store,Sa.store,Ca.store,Da.store,ba.store,xa.store,Pa.store,La.store,Ra.store,Oa.store,Ma.store,Fa.store],Va="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class qa{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class ja{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&zr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ja((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ja?t:ja.resolve(t)}catch(e){return ja.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ja.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ja.reject(t)}static resolve(e){return new ja((t,n)=>{t(e)})}static reject(e){return new ja((t,n)=>{n(e)})}static waitFor(e){return new ja((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ja.resolve(!1);for(const n of e)t=t.next(e=>e?ja.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}}class Ba{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new Hr,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new Ga(e,t.error)):this.It.resolve()},this.transaction.onerror=t=>{const n=Ja(t.target.error);this.It.reject(new Ga(e,n))}}static open(e,t,n,r){try{return new Ba(t,e.transaction(r,n))}catch(e){throw new Ga(t,e)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(Vr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new Wa(t)}}class za{constructor(e,t,n){this.name=e,this.version=t,this.Rt=n,12.2===za.bt((0,S.z$)())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Vr("SimpleDb","Removing database:",e),Ha(window.indexedDB.deleteDatabase(e)).toPromise()}static Pt(){if(!(0,S.hl)())return!1;if(za.vt())return!0;const e=(0,S.z$)(),t=za.bt(e),n=0<t&&t<10,r=za.Vt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static vt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static bt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ct(e){return this.db||(Vr("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new Ga(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;n("VersionError"===r.name?new Wr($r.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===r.name?new Wr($r.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r):new Ga(e,r))},r.onupgradeneeded=e=>{Vr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion),this.Rt.Nt(e.target.result,r.transaction,e.oldVersion,this.version).next(()=>{Vr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.kt&&(this.db.onversionchange=e=>this.kt(e)),this.db}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Ct(e);const t=Ba.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch(e=>(t.abort(e),ja.reject(e))).toPromise();return s.catch(()=>{}),await t.At,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(Vr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ka{constructor(e){this.$t=e,this.Ot=!1,this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(e){this.$t=e}done(){this.Ot=!0}Lt(e){this.Mt=e}delete(){return Ha(this.$t.delete())}}class Ga extends Wr{constructor(e,t){super($r.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function $a(e){return"IndexedDbTransactionError"===e.name}class Wa{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Vr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Vr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ha(n)}add(e){return Vr("SimpleDb","ADD",this.store.name,e,e),Ha(this.store.add(e))}get(e){return Ha(this.store.get(e)).next(t=>(void 0===t&&(t=null),Vr("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return Vr("SimpleDb","DELETE",this.store.name,e),Ha(this.store.delete(e))}count(){return Vr("SimpleDb","COUNT",this.store.name),Ha(this.store.count())}Bt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,(e,t)=>{r.push(t)}).next(()=>r)}qt(e,t){Vr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Kt=!1;const r=this.cursor(n);return this.Ut(r,(e,t,n)=>n.delete())}jt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Ut(r,t)}Qt(e){const t=this.cursor({});return new ja((n,r)=>{t.onerror=e=>{const t=Ja(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}Ut(e,t){const n=[];return new ja((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Ka(i),o=t(i.primaryKey,i.value,s);if(o instanceof ja){const e=o.catch(e=>(s.done(),ja.reject(e)));n.push(e)}s.isDone?r():null===s.Ft?i.continue():i.continue(s.Ft)}}).next(()=>ja.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ha(e){return new ja((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{const t=Ja(e.target.error);n(t)}})}let Qa=!1;function Ja(e){const t=za.bt((0,S.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Wr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Qa||(Qa=!0,setTimeout(()=>{throw e},0)),e}}return e}class Ya extends qa{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function Xa(e,t){const n=Gr(e);return za.Dt(n.Wt,t)}class Za{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Ys(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Xs(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Xs(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(hi.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ao())}isEqual(e){return this.batchId===e.batchId&&ai(this.mutations,e.mutations,(e,t)=>eo(e,t))&&ai(this.baseMutations,e.baseMutations,(e,t)=>eo(e,t))}}class ec{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Kr(e.mutations.length===n.length);let r=ko();const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new ec(e,t,n,r)}}class tc{constructor(e,t,n,r,i=hi.min(),s=hi.min(),o=wi.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new tc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new tc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new tc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class nc{constructor(e){this.Gt=e}}function rc(e,t){if(t.document)return ta(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=Ri.fromSegments(t.noDocument.path),n=cc(t.noDocument.readTime),r=Wi.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=Ri.fromSegments(t.unknownDocument.path),n=cc(t.unknownDocument.version);return Wi.newUnknownDocument(e,n)}return zr()}function ic(e,t,n){const r=sc(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const n=function(e,t){return{name:Ho(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Bo(e,t.version.toTimestamp())}}(e.Gt,t);return new Ca(null,null,n,t.hasCommittedMutations,r,i)}if(t.isNoDocument()){const e=t.key.path.toArray(),n=ac(t.version),s=t.hasCommittedMutations;return new Ca(null,new Aa(e,n),null,s,r,i)}if(t.isUnknownDocument()){const e=t.key.path.toArray(),n=ac(t.version);return new Ca(new Na(e,n),null,null,!0,r,i)}return zr()}function sc(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function oc(e){const t=new ui(e[0],e[1]);return hi.fromTimestamp(t)}function ac(e){const t=e.toTimestamp();return new _a(t.seconds,t.nanoseconds)}function cc(e){const t=new ui(e.seconds,e.nanoseconds);return hi.fromTimestamp(t)}function uc(e,t){const n=(t.baseMutations||[]).map(t=>ra(e.Gt,t));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform&&(e.updateTransforms=t.mutations[s+1].transform.fieldTransforms,t.mutations.splice(s+1,1),++s)}const r=t.mutations.map(t=>ra(e.Gt,t)),i=ui.fromMillis(t.localWriteTimeMs);return new Za(t.batchId,i,n,r)}function hc(e){const t=cc(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?cc(e.lastLimboFreeSnapshotVersion):hi.min();let r;var i;return void 0!==e.query.documents?(Kr(1===(i=e.query).documents.length),r=bs(ms(Yo(i.documents[0])))):r=function(e){return bs(oa(e))}(e.query),new tc(r,e.targetId,0,e.lastListenSequenceNumber,t,n,wi.fromBase64String(e.resumeToken))}function lc(e,t){const n=ac(t.snapshotVersion),r=ac(t.lastLimboFreeSnapshotVersion);let i;i=Xi(t.target)?ia(e.Gt,t.target):sa(e.Gt,t.target);const s=t.resumeToken.toBase64();return new Da(t.targetId,Ji(t.target),n,s,t.sequenceNumber,r,i)}function dc(e){const t=oa({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Es(t,t.limit,"L"):t}class fc{getBundleMetadata(e,t){return pc(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:cc(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return pc(e).put({bundleId:(n=t).id,createTime:ac(Go(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return gc(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:dc(t.bundledQuery),readTime:cc(t.readTime)};var t})}saveNamedQuery(e,t){return gc(e).put(function(e){return{name:e.name,readTime:ac(Go(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function pc(e){return Xa(e,Ma.store)}function gc(e){return Xa(e,Fa.store)}class mc{constructor(){this.zt=new yc}addToCollectionParentIndex(e,t){return this.zt.add(t),ja.resolve()}getCollectionParents(e,t){return ja.resolve(this.zt.getEntries(t))}}class yc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new vo(gi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new vo(gi.comparator)).toArray()}}class vc{constructor(){this.Ht=new yc}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ht.add(t)});const i={collectionId:n,parent:va(r)};return wc(e).put(i)}return ja.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[ci(t),""],!1,!0);return wc(e).Bt(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Ta(r.parent))}return n})}}function wc(e){return Xa(e,Oa.store)}const Ic={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Tc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Tc(e,Tc.DEFAULT_COLLECTION_PERCENTILE,Tc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function _c(e,t,n){const r=e.store(ka.store),i=e.store(Sa.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.jt({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{Kr(1===a)}));const u=[];for(const h of n.mutations){const e=Sa.key(t,h.key.path,n.batchId);s.push(i.delete(e)),u.push(h.key)}return ja.waitFor(s).next(()=>u)}function bc(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw zr();t=e.noDocument}return JSON.stringify(t).length}Tc.DEFAULT_COLLECTION_PERCENTILE=10,Tc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tc.DEFAULT=new Tc(41943040,Tc.DEFAULT_COLLECTION_PERCENTILE,Tc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tc.DISABLED=new Tc(-1,0,0);class Ec{constructor(e,t,n,r){this.userId=e,this.k=t,this.Jt=n,this.referenceDelegate=r,this.Yt={}}static Xt(e,t,n,r){Kr(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ec(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Sc(e).jt({index:ka.userMutationsIndex,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=Ac(e),s=Sc(e);return s.add({}).next(o=>{Kr("number"==typeof o);const a=new Za(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map(t=>na(e.Gt,t)),i=n.mutations.map(t=>na(e.Gt,t));return new ka(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(this.k,this.userId,a),u=[];let h=new vo((e,t)=>oi(e.canonicalString(),t.canonicalString()));for(const e of r){const t=Sa.key(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Sa.PLACEHOLDER))}return h.forEach(t=>{u.push(this.Jt.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Yt[o]=a.keys()}),ja.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return Sc(e).get(t).next(e=>e?(Kr(e.userId===this.userId),uc(this.k,e)):null)}Zt(e,t){return this.Yt[t]?ja.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Yt[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Sc(e).jt({index:ka.userMutationsIndex,range:r},(e,t,r)=>{t.userId===this.userId&&(Kr(t.batchId>=n),i=uc(this.k,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Sc(e).jt({index:ka.userMutationsIndex,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Sc(e).Bt(ka.userMutationsIndex,t).next(e=>e.map(e=>uc(this.k,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Sa.prefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Ac(e).jt({range:r},(n,r,s)=>{const[o,a,c]=n,u=Ta(a);if(o===this.userId&&t.path.isEqual(u))return Sc(e).get(c).next(e=>{if(!e)throw zr();Kr(e.userId===this.userId),i.push(uc(this.k,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new vo(oi);const r=[];return t.forEach(t=>{const i=Sa.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Ac(e).jt({range:s},(e,r,i)=>{const[s,o,a]=e,c=Ta(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()});r.push(o)}),ja.waitFor(r).next(()=>this.te(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Sa.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new vo(oi);return Ac(e).jt({range:s},(e,t,i)=>{const[s,a,c]=e,u=Ta(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()}).next(()=>this.te(e,o))}te(e,t){const n=[],r=[];return t.forEach(t=>{r.push(Sc(e).get(t).next(e=>{if(null===e)throw zr();Kr(e.userId===this.userId),n.push(uc(this.k,e))}))}),ja.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return _c(e.Wt,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.ee(t.batchId)}),ja.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return ja.resolve();const n=IDBKeyRange.lowerBound(Sa.prefixForUser(this.userId)),r=[];return Ac(e).jt({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=Ta(e[1]);r.push(t)}else n.done()}).next(()=>{Kr(0===r.length)})})}containsKey(e,t){return kc(e,this.userId,t)}ne(e){return Nc(e).get(this.userId).next(e=>e||new Ea(this.userId,-1,""))}}function kc(e,t,n){const r=Sa.prefixForPath(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Ac(e).jt({range:s,Kt:!0},(e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function Sc(e){return Xa(e,ka.store)}function Ac(e){return Xa(e,Sa.store)}function Nc(e){return Xa(e,Ea.store)}class Cc{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new Cc(0)}static re(){return new Cc(-1)}}class Rc{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next(t=>{const n=new Cc(t.highestTargetId);return t.highestTargetId=n.next(),this.ce(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.oe(e).next(e=>hi.fromTimestamp(new ui(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.oe(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.oe(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.ce(e,r)))}addTargetData(e,t){return this.ae(e,t).next(()=>this.oe(e).next(n=>(n.targetCount+=1,this.ue(t,n),this.ce(e,n))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Dc(e).delete(t.targetId)).next(()=>this.oe(e)).next(t=>(Kr(t.targetCount>0),t.targetCount-=1,this.ce(e,t)))}removeTargets(e,t,n){let r=0;const i=[];return Dc(e).jt((s,o)=>{const a=hc(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>ja.waitFor(i)).next(()=>r)}forEachTarget(e,t){return Dc(e).jt((e,n)=>{const r=hc(n);t(r)})}oe(e){return Pc(e).get(xa.key).next(e=>(Kr(null!==e),e))}ce(e,t){return Pc(e).put(xa.key,t)}ae(e,t){return Dc(e).put(lc(this.k,t))}ue(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.oe(e).next(e=>e.targetCount)}getTargetData(e,t){const n=Ji(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Dc(e).jt({range:r,index:Da.queryTargetsIndexName},(e,n,r)=>{const s=hc(n);Yi(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=xc(e);return t.forEach(t=>{const s=va(t.path);r.push(i.put(new Pa(n,s))),r.push(this.referenceDelegate.addReference(e,n,t))}),ja.waitFor(r)}removeMatchingKeys(e,t,n){const r=xc(e);return ja.forEach(t,t=>{const i=va(t.path);return ja.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=xc(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=xc(e);let i=Ao();return r.jt({range:n,Kt:!0},(e,t,n)=>{const r=Ta(e[1]),s=new Ri(r);i=i.add(s)}).next(()=>i)}containsKey(e,t){const n=va(t.path),r=IDBKeyRange.bound([n],[ci(n)],!1,!0);let i=0;return xc(e).jt({index:Pa.documentTargetsIndex,Kt:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}Et(e,t){return Dc(e).get(t).next(e=>e?hc(e):null)}}function Dc(e){return Xa(e,Da.store)}function Pc(e){return Xa(e,xa.store)}function xc(e){return Xa(e,Pa.store)}async function Oc(e){if(e.code!==$r.FAILED_PRECONDITION||e.message!==Va)throw e;Vr("LocalStore","Unexpectedly lost primary lease")}function Lc([e,t],[n,r]){const i=oi(e,n);return 0===i?oi(t,r):i}class Mc{constructor(e){this.he=e,this.buffer=new vo(Lc),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Lc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Fc{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){const t=this.we?3e5:6e4;Vr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this._e=null,this.we=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){$a(e)?Vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Oc(e)}await this.me(e)})}}class Uc{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ja.resolve(ri.I);const n=new Mc(t);return this.ge.forEachTarget(e,e=>n.de(e.sequenceNumber)).next(()=>this.ge.pe(e,e=>n.de(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.ge.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; disabled"),ja.resolve(Ic)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ic):this.Te(e,t))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Vr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),Ur()<=k.in.DEBUG&&Vr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),ja.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class Vc{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Uc(e,t)}(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Ee(e){let t=0;return this.pe(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,(e,n)=>t(n))}addReference(e,t,n){return qc(e,n)}removeReference(e,t,n){return qc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return qc(e,t)}Ae(e,t){return function(e,t){let n=!1;return Nc(e).Qt(r=>kc(e,r,t).next(e=>(e&&(n=!0),ja.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Ie(e,(s,o)=>{if(o<=t){const t=this.Ae(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s),xc(e).delete([0,va(s.path)])))});r.push(t)}}).next(()=>ja.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return qc(e,t)}Ie(e,t){const n=xc(e);let r,i=ri.I;return n.jt({index:Pa.documentTargetsIndex},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==ri.I&&t(new Ri(Ta(r)),i),i=o,r=s):i=ri.I}).next(()=>{i!==ri.I&&t(new Ri(Ta(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function qc(e,t){return xc(e).put(function(e,t){return new Pa(0,va(e.path),t)}(t,e.currentSequenceNumber))}class jc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){di(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return fi(this.inner)}}class Bc{constructor(){this.changes=new jc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:hi.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:Wi.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ja.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zc{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,n){return $c(e).put(Wc(t),n)}removeEntry(e,t){const n=$c(e),r=Wc(t);return n.delete(r)}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Re(e,n)))}getEntry(e,t){return $c(e).get(Wc(t)).next(e=>this.be(t,e))}Pe(e,t){return $c(e).get(Wc(t)).next(e=>({document:this.be(t,e),size:bc(e)}))}getEntries(e,t){let n=To();return this.ve(e,t,(e,t)=>{const r=this.be(e,t);n=n.insert(e,r)}).next(()=>n)}Ve(e,t){let n=To(),r=new go(Ri.comparator);return this.ve(e,t,(e,t)=>{const i=this.be(e,t);n=n.insert(e,i),r=r.insert(e,bc(t))}).next(()=>({documents:n,Se:r}))}ve(e,t,n){if(t.isEmpty())return ja.resolve();const r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let s=i.getNext();return $c(e).jt({range:r},(e,t,r)=>{const o=Ri.fromSegments(e);for(;s&&Ri.comparator(s,o)<0;)n(s,null),s=i.getNext();s&&s.isEqual(o)&&(n(s,t),s=i.hasNext()?i.getNext():null),s?r.Lt(s.path.toArray()):r.done()}).next(()=>{for(;s;)n(s,null),s=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,n){let r=To();const i=t.path.length+1,s={};if(n.isEqual(hi.min())){const e=t.path.toArray();s.range=IDBKeyRange.lowerBound(e)}else{const e=t.path.toArray(),r=sc(n);s.range=IDBKeyRange.lowerBound([e,r],!0),s.index=Ca.collectionReadTimeIndex}return $c(e).jt(s,(e,n,s)=>{if(e.length!==i)return;const o=rc(this.k,n);t.path.isPrefixOf(o.key.path)?Ns(t,o)&&(r=r.insert(o.key,o)):s.done()}).next(()=>r)}newChangeBuffer(e){return new Kc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Gc(e).get(Ra.key).next(e=>(Kr(!!e),e))}Re(e,t){return Gc(e).put(Ra.key,t)}be(e,t){if(t){const e=rc(this.k,t);if(!e.isNoDocument()||!e.version.isEqual(hi.min()))return e}return Wi.newInvalidDocument(e)}}class Kc extends Bc{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new jc(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new vo((e,t)=>oi(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const o=this.Ce.get(i);if(s.document.isValidDocument()){const a=ic(this.De.k,s.document,this.getReadTime(i));r=r.add(i.path.popLast());const c=bc(a);n+=c-o,t.push(this.De.addEntry(e,i,a))}else if(n-=o,this.trackRemovals){const n=ic(this.De.k,Wi.newNoDocument(i,hi.min()),this.getReadTime(i));t.push(this.De.addEntry(e,i,n))}else t.push(this.De.removeEntry(e,i))}),r.forEach(n=>{t.push(this.De.Jt.addToCollectionParentIndex(e,n))}),t.push(this.De.updateMetadata(e,n)),ja.waitFor(t)}getFromCache(e,t){return this.De.Pe(e,t).next(e=>(this.Ce.set(t,e.size),e.document))}getAllFromCache(e,t){return this.De.Ve(e,t).next(({documents:e,Se:t})=>(t.forEach((e,t)=>{this.Ce.set(e,t)}),e))}}function Gc(e){return Xa(e,Ra.store)}function $c(e){return Xa(e,Ca.store)}function Wc(e){return e.path.toArray()}class Hc{constructor(e){this.k=e}Nt(e,t,n,r){Kr(n<r&&n>=0&&r<=11);const i=new Ba("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(ba.store)}(e),function(e){e.createObjectStore(Ea.store,{keyPath:Ea.keyPath}),e.createObjectStore(ka.store,{keyPath:ka.keyPath,autoIncrement:!0}).createIndex(ka.userMutationsIndex,ka.userMutationsKeyPath,{unique:!0}),e.createObjectStore(Sa.store)}(e),Qc(e),function(e){e.createObjectStore(Ca.store)}(e));let s=ja.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Pa.store),e.deleteObjectStore(Da.store),e.deleteObjectStore(xa.store)}(e),Qc(e)),s=s.next(()=>function(e){const t=e.store(xa.store),n=new xa(0,0,hi.min().toTimestamp(),0);return t.put(xa.key,n)}(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>function(e,t){return t.store(ka.store).Bt().next(n=>{e.deleteObjectStore(ka.store),e.createObjectStore(ka.store,{keyPath:ka.keyPath,autoIncrement:!0}).createIndex(ka.userMutationsIndex,ka.userMutationsKeyPath,{unique:!0});const r=t.store(ka.store),i=n.map(e=>r.put(e));return ja.waitFor(i)})}(e,i))),s=s.next(()=>{!function(e){e.createObjectStore(La.store,{keyPath:La.keyPath})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.Ne(i))),n<6&&r>=6&&(s=s.next(()=>(function(e){e.createObjectStore(Ra.store)}(e),this.ke(i)))),n<7&&r>=7&&(s=s.next(()=>this.xe(i))),n<8&&r>=8&&(s=s.next(()=>this.$e(e,i))),n<9&&r>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){const t=e.objectStore(Ca.store);t.createIndex(Ca.readTimeIndex,Ca.readTimeIndexPath,{unique:!1}),t.createIndex(Ca.collectionReadTimeIndex,Ca.collectionReadTimeIndexPath,{unique:!1})}(t)})),n<10&&r>=10&&(s=s.next(()=>this.Oe(i))),n<11&&r>=11&&(s=s.next(()=>{!function(e){e.createObjectStore(Ma.store,{keyPath:Ma.keyPath})}(e),function(e){e.createObjectStore(Fa.store,{keyPath:Fa.keyPath})}(e)})),s}ke(e){let t=0;return e.store(Ca.store).jt((e,n)=>{t+=bc(n)}).next(()=>{const n=new Ra(t);return e.store(Ra.store).put(Ra.key,n)})}Ne(e){const t=e.store(Ea.store),n=e.store(ka.store);return t.Bt().next(t=>ja.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.Bt(ka.userMutationsIndex,r).next(n=>ja.forEach(n,n=>{Kr(n.userId===t.userId);const r=uc(this.k,n);return _c(e,t.userId,r).next(()=>{})}))}))}xe(e){const t=e.store(Pa.store),n=e.store(Ca.store);return e.store(xa.store).get(xa.key).next(e=>{const r=[];return n.jt((n,i)=>{const s=new gi(n),o=function(e){return[0,va(e)]}(s);r.push(t.get(o).next(n=>n?ja.resolve():(n=>t.put(new Pa(0,va(n),e.highestListenSequenceNumber)))(s)))}).next(()=>ja.waitFor(r))})}$e(e,t){e.createObjectStore(Oa.store,{keyPath:Oa.keyPath});const n=t.store(Oa.store),r=new yc,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:va(r)})}};return t.store(Ca.store).jt({Kt:!0},(e,t)=>{const n=new gi(e);return i(n.popLast())}).next(()=>t.store(Sa.store).jt({Kt:!0},([e,t,n],r)=>{const s=Ta(t);return i(s.popLast())}))}Oe(e){const t=e.store(Da.store);return t.jt((e,n)=>{const r=hc(n),i=lc(this.k,r);return t.put(i)})}}function Qc(e){e.createObjectStore(Pa.store,{keyPath:Pa.keyPath}).createIndex(Pa.documentTargetsIndex,Pa.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Da.store,{keyPath:Da.keyPath}).createIndex(Da.queryTargetsIndexName,Da.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(xa.store)}const Jc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Yc{constructor(e,t,n,r,i,s,o,a,c,u){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Me=i,this.window=s,this.document=o,this.Fe=c,this.Le=u,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=e=>Promise.resolve(),!Yc.Pt())throw new Wr($r.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Vc(this,r),this.Ge=t+"main",this.k=new nc(a),this.ze=new za(this.Ge,11,new Hc(this.k)),this.He=new Rc(this.referenceDelegate,this.k),this.Jt=new vc,this.Je=function(e,t){return new zc(e,t)}(this.k,this.Jt),this.Ye=new fc,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===u&&qr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Wr($r.FAILED_PRECONDITION,Jc);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.He.getHighestSequenceNumber(e))}).then(e=>{this.Be=new ri(e,this.Fe)}).then(()=>{this.Ue=!0}).catch(e=>(this.ze&&this.ze.close(),Promise.reject(e)))}sn(e){return this.We=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Me.enqueueAndForget(async()=>{this.started&&await this.Ze()}))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Zc(e).put(new La(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(e).next(e=>{e||(this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(e)).next(t=>this.isPrimary&&!t?this.cn(e).next(()=>!1):!!t&&this.an(e).next(()=>!0))).catch(e=>{if($a(e))return Vr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Me.enqueueRetryable(()=>this.We(e)),this.isPrimary=e})}rn(e){return Xc(e).get(ba.key).next(e=>ja.resolve(this.un(e)))}hn(e){return Zc(e).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=Xa(e,La.store);return t.Bt().next(e=>{const n=this.dn(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return ja.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Xe)for(const t of e)this.Xe.removeItem(this.wn(t.clientId))}}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?ja.resolve(!0):Xc(e).get(ba.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new Wr($r.FAILED_PRECONDITION,Jc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Zc(e).Bt().next(e=>void 0===this.dn(e,5e3).find(e=>{if(this.clientId!==e.clientId){const t=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(!this.networkEnabled&&e.networkEnabled||t&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&Vr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[ba.store,La.store],e=>{const t=new Ya(e,ri.I);return this.cn(t).next(()=>this.hn(t))}),this.ze.close(),this.pn()}dn(e,t){return e.filter(e=>this.fn(e.updateTimeMs,t)&&!this._n(e.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",e=>Zc(e).Bt().next(e=>this.dn(e,18e5).map(e=>e.clientId)))}get started(){return this.Ue}getMutationQueue(e){return Ec.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,n){let r;return Vr("IndexedDbPersistence","Starting transaction:",e),this.ze.runTransaction(e,"readonly"===t?"readonly":"readwrite",Ua,i=>(r=new Ya(i,this.Be?this.Be.next():ri.I),"readwrite-primary"===t?this.rn(r).next(e=>!!e||this.on(r)).next(t=>{if(!t)throw qr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)),new Wr($r.FAILED_PRECONDITION,Va);return n(r)}).next(e=>this.an(r).next(()=>e)):this.En(r).next(()=>n(r)))).then(e=>(r.raiseOnCommittedEvent(),e))}En(e){return Xc(e).get(ba.key).next(e=>{if(null!==e&&this.fn(e.leaseTimestampMs,5e3)&&!this._n(e.ownerId)&&!this.un(e)&&!(this.Le||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Wr($r.FAILED_PRECONDITION,Jc)})}an(e){const t=new ba(this.clientId,this.allowTabSynchronization,Date.now());return Xc(e).put(ba.key,t)}static Pt(){return za.Pt()}cn(e){const t=Xc(e);return t.get(ba.key).next(e=>this.un(e)?(Vr("IndexedDbPersistence","Releasing primary lease."),t.delete(ba.key)):ja.resolve())}fn(e,t){const n=Date.now();return!(e<n-t||e>n&&(qr(`Detected an update time that is in the future: ${e} > ${n}`),1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Me.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),(0,S.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Me.enterRestrictedMode(!0),this.Me.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return Vr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return qr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(q){qr("Failed to set zombie client id.",q)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(q){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Xc(e){return Xa(e,ba.store)}function Zc(e){return Xa(e,La.store)}function eu(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class tu{constructor(e,t){this.progress=e,this.In=t}}class nu{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.bn(e,t,n))}bn(e,t,n){return this.Je.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,t){e.forEach((e,n)=>{for(const r of t)r.applyToLocalView(n)})}vn(e,t){return this.Je.getEntries(e,t).next(t=>this.Vn(e,t).next(()=>t))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return function(e){return Ri.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):Ts(t)?this.Dn(e,t,n):this.Cn(e,t,n)}Sn(e,t){return this.Rn(e,new Ri(t)).next(e=>{let t=bo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Dn(e,t,n){const r=t.collectionGroup;let i=bo();return this.Jt.getCollectionParents(e,r).next(s=>ja.forEach(s,s=>{const o=function(e,t){return new ps(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.Cn(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next(n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(i=t,this.Nn(e,i,r).next(e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=Wi.newInvalidDocument(n),r=r.insert(n,i)),Xs(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((e,n)=>{Ns(t,n)||(r=r.remove(e))}),r))}Nn(e,t,n){let r=Ao();for(const s of t)for(const e of s.mutations)e instanceof ro&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class ru{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=Ao(),r=Ao();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new ru(e,t.fromCache,n,r)}}class iu{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(hi.min())?this.Fn(e,t):this.Mn.vn(e,r).next(i=>{const s=this.Ln(t,i);return(ys(t)||vs(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(Ur()<=k.in.DEBUG&&Vr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),As(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))})}Ln(e,t){let n=new vo(Cs(e));return t.forEach((t,r)=>{Ns(e,r)&&(n=n.add(r))}),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return Ur()<=k.in.DEBUG&&Vr("QueryEngine","Using full collection scan to execute query:",As(t)),this.Mn.getDocumentsMatchingQuery(e,t,hi.min())}}class su{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new go(oi),this.Kn=new jc(e=>Ji(e),Yi),this.jn=hi.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new nu(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function ou(e,t,n,r){return new su(e,t,n,r)}async function au(e,t){const n=Gr(e);let r=n.An,i=n.Wn;const s=await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.An.getAllMutationBatches(e).next(o=>(s=o,r=n.persistence.getMutationQueue(t),i=new nu(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e))).next(t=>{const n=[],r=[];let o=Ao();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next(e=>({Gn:e,removedBatchIds:n,addedBatchIds:r}))})});return n.An=r,n.Wn=i,n.Un.On(n.Wn),s}function cu(e){const t=Gr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.He.getLastRemoteSnapshotVersion(e))}function uu(e,t,n,r,i){let s=Ao();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=To();return n.forEach((n,o)=>{const a=e.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(hi.min())?(t.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),s=s.insert(n,o)):Vr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}function hu(e,t){const n=Gr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)))}function lu(e,t){const n=Gr(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.He.getTargetData(e,t).next(i=>i?(r=i,ja.resolve(r)):n.He.allocateTargetId(e).next(i=>(r=new tc(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e})}async function du(e,t,n){const r=Gr(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!$a(e))throw e;Vr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)}function fu(e,t,n){const r=Gr(e);let i=hi.min(),s=Ao();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=Gr(e),i=r.Kn.get(n);return void 0!==i?ja.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,bs(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:hi.min(),n?s:Ao())).next(e=>({documents:e,zn:s})))}function pu(e,t){const n=Gr(e),r=Gr(n.He),i=n.qn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Et(e,t).next(e=>e?e.target:null))}function gu(e){const t=Gr(e);return t.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=Gr(e);let i=To(),s=sc(n);const o=$c(t),a=IDBKeyRange.lowerBound(s,!0);return o.jt({index:Ca.readTimeIndex,range:a},(e,t)=>{const n=rc(r.k,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({In:i,readTime:oc(s)}))}(t.Qn,e,t.jn)).then(({In:e,readTime:n})=>(t.jn=n,e))}async function mu(e,t,n=Ao()){const r=await lu(e,bs(dc(t.bundledQuery))),i=Gr(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{const s=Go(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ye.saveNamedQuery(e,t);const o=r.withResumeToken(wi.EMPTY_BYTE_STRING,s);return i.qn=i.qn.insert(o.targetId,o),i.He.updateTargetData(e,o).next(()=>i.He.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.He.addMatchingKeys(e,n,r.targetId)).next(()=>i.Ye.saveNamedQuery(e,t))})}class yu{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return ja.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:Go(n.createTime)}),ja.resolve()}getNamedQuery(e,t){return ja.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:dc(e.bundledQuery),readTime:Go(e.readTime)}}(t)),ja.resolve()}}class vu{constructor(){this.ts=new vo(wu.es),this.ns=new vo(wu.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new wu(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.os(new wu(e,t))}cs(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new Ri(new gi([])),n=new wu(t,e),r=new wu(t,e+1),i=[];return this.ns.forEachInRange([n,r],e=>{this.os(e),i.push(e.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new Ri(new gi([])),n=new wu(t,e),r=new wu(t,e+1);let i=Ao();return this.ns.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new wu(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class wu{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return Ri.comparator(e.key,t.key)||oi(e.fs,t.fs)}static ss(e,t){return oi(e.fs,t.fs)||Ri.comparator(e.key,t.key)}}class Iu{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new vo(wu.es)}checkEmpty(e){return ja.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++;const s=new Za(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new wu(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return ja.resolve(s)}lookupMutationBatch(e,t){return ja.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=this.gs(t+1),r=n<0?0:n;return ja.resolve(this.An.length>r?this.An[r]:null)}getHighestUnacknowledgedBatchId(){return ja.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return ja.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new wu(t,0),r=new wu(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],e=>{const t=this._s(e.fs);i.push(t)}),ja.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new vo(oi);return t.forEach(e=>{const t=new wu(e,0),r=new wu(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],e=>{n=n.add(e.fs)})}),ja.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Ri.isDocumentKey(i)||(i=i.child(""));const s=new wu(new Ri(i),0);let o=new vo(oi);return this.ws.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)},s),ja.resolve(this.ys(o))}ys(e){const t=[];return e.forEach(e=>{const n=this._s(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Kr(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return ja.forEach(t.mutations,r=>{const i=new wu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ws=n})}ee(e){}containsKey(e,t){const n=new wu(t,0),r=this.ws.firstAfterOrEqual(n);return ja.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return ja.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class Tu{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new go(Ri.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ja.resolve(n?n.document.mutableCopy():Wi.newInvalidDocument(t))}getEntries(e,t){let n=To();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Wi.newInvalidDocument(e))}),ja.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=To();const i=new Ri(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||Ns(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return ja.resolve(r)}Es(e,t){return ja.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new _u(this)}getSize(e){return ja.resolve(this.size)}}class _u extends Bc{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)}),ja.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class bu{constructor(e){this.persistence=e,this.Is=new jc(e=>Ji(e),Yi),this.lastRemoteSnapshotVersion=hi.min(),this.highestTargetId=0,this.As=0,this.Rs=new vu,this.targetCount=0,this.bs=Cc.ie()}forEachTarget(e,t){return this.Is.forEach((e,n)=>t(n)),ja.resolve()}getLastRemoteSnapshotVersion(e){return ja.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ja.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),ja.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),ja.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new Cc(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,ja.resolve()}updateTargetData(e,t){return this.ae(t),ja.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,ja.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),ja.waitFor(i).next(()=>r)}getTargetCount(e){return ja.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return ja.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),ja.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ja.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),ja.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return ja.resolve(n)}containsKey(e,t){return ja.resolve(this.Rs.containsKey(t))}}class Eu{constructor(e,t){this.Ps={},this.Be=new ri(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new bu(this),this.Jt=new mc,this.Je=function(e,t){return new Tu(e,t)}(this.Jt,e=>this.referenceDelegate.vs(e)),this.k=new nc(t),this.Ye=new yu(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new Iu(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){Vr("MemoryPersistence","Starting transaction:",e);const r=new ku(this.Be.next());return this.referenceDelegate.Vs(),n(r).next(e=>this.referenceDelegate.Ss(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ds(e,t){return ja.or(Object.values(this.Ps).map(n=>()=>n.containsKey(e,t)))}}class ku extends qa{constructor(e){super(),this.currentSequenceNumber=e}}class Su{constructor(e){this.persistence=e,this.Cs=new vu,this.Ns=null}static ks(e){return new Su(e)}get xs(){if(this.Ns)return this.Ns;throw zr()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),ja.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),ja.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),ja.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ja.forEach(this.xs,n=>{const r=Ri.fromPath(n);return this.$s(e,r).next(e=>{e||t.removeEntry(r)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return ja.or([()=>ja.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function Au(e,t){return`firestore_clients_${e}_${t}`}function Nu(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Cu(e,t){return`firestore_targets_${e}_${t}`}class Ru{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Os(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Wr(r.error.code,r.error.message))),s?new Ru(e,t,r.state,i):(qr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Du{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Os(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Wr(n.error.code,n.error.message))),i?new Du(e,n.state,r):(qr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Pu{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Os(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Co();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Ci(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new Pu(e,i):(qr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class xu{constructor(e,t){this.clientId=e,this.onlineState=t}static Os(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new xu(t.clientId,t.onlineState):(qr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ou{constructor(){this.activeTargetIds=Co()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Lu{constructor(e,t,n,r,i){this.window=e,this.Me=t,this.persistenceKey=n,this.Bs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new go(oi),this.started=!1,this.js=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=Au(this.persistenceKey,this.Bs),this.Ws=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new Ou),this.Gs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Js=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Ys=function(e){return`firestore_bundle_loaded_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static Pt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Tn();for(const n of e){if(n===this.Bs)continue;const e=this.getItem(Au(this.persistenceKey,n));if(e){const t=Pu.Os(n,e);t&&(this.Ks=this.Ks.insert(t.clientId,t))}}this.Xs();const t=this.storage.getItem(this.Js);if(t){const e=this.Zs(t);e&&this.ti(e)}for(const n of this.js)this.qs(n);this.js=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,n){this.ni(e,t,n),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Cu(this.persistenceKey,e));if(n){const r=Du.Os(e,n);r&&(t=r.state)}}return this.ii.Fs(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Cu(this.persistenceKey,e))}updateQueryState(e,t,n){this.ri(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.si(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ci()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Vr("SharedClientState","READ",e,t),t}setItem(e,t){Vr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Vr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){const t=e;if(t.storageArea===this.storage){if(Vr("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Qs)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Me.enqueueRetryable(async()=>{if(this.started){if(null!==t.key)if(this.Gs.test(t.key)){if(null==t.newValue){const e=this.ai(t.key);return this.ui(e,null)}{const e=this.hi(t.key,t.newValue);if(e)return this.ui(e.clientId,e)}}else if(this.zs.test(t.key)){if(null!==t.newValue){const e=this.li(t.key,t.newValue);if(e)return this.fi(e)}}else if(this.Hs.test(t.key)){if(null!==t.newValue){const e=this.di(t.key,t.newValue);if(e)return this.wi(e)}}else if(t.key===this.Js){if(null!==t.newValue){const e=this.Zs(t.newValue);if(e)return this.ti(e)}}else if(t.key===this.Ws){const e=function(e){let t=ri.I;if(null!=e)try{const n=JSON.parse(e);Kr("number"==typeof n),t=n}catch(e){qr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==ri.I&&this.sequenceNumberHandler(e)}else if(t.key===this.Ys)return this.syncEngine._i()}else this.js.push(t)})}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Ms())}ni(e,t,n){const r=new Ru(this.currentUser,e,t,n),i=Nu(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ms())}si(e){const t=Nu(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){this.storage.setItem(this.Js,JSON.stringify({clientId:this.Bs,onlineState:e}))}ri(e,t,n){const r=Cu(this.persistenceKey,e),i=new Du(e,t,n);this.setItem(r,i.Ms())}ci(){this.setItem(this.Ys,"value-not-used")}ai(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const n=this.ai(e);return Pu.Os(n,t)}li(e,t){const n=this.zs.exec(e),r=Number(n[1]);return Ru.Os(new Lr(void 0!==n[2]?n[2]:null),r,t)}di(e,t){const n=this.Hs.exec(e),r=Number(n[1]);return Du.Os(r,t)}Zs(e){return xu.Os(e)}async fi(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.mi(e.batchId,e.state,e.error);Vr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const n=t?this.Ks.insert(e,t):this.Ks.remove(e),r=this.ei(this.Ks),i=this.ei(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.yi(s,o).then(()=>{this.Ks=n})}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=Co();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class Mu{constructor(){this.pi=new Ou,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new Ou,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Fu{Ei(e){}shutdown(){}}class Uu{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){Vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){Vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Vu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class qu{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class ju extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);Vr("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then(e=>(Vr("RestConnection","Received: ",e),e),t=>{throw jr("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Mr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Ui(e,t){return`${this.Fi}/v1/${t}:${Vu[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise((i,s)=>{const o=new xr;o.listenOnce(Nr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Ar.NO_ERROR:const t=o.getResponseJson();Vr("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Ar.TIMEOUT:Vr("Connection",'RPC "'+e+'" timed out'),s(new Wr($r.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:const n=o.getStatus();if(Vr("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values($r).indexOf(t)>=0?t:$r.UNKNOWN}(e.status);s(new Wr(t,e.message))}else s(new Wr($r.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Wr($r.UNAVAILABLE,"Connection failed."));break;default:zr()}}finally{Vr("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=kr(),s=Sr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Dr({})),this.qi(o.initMessageHeaders,t,n),(0,S.uI)()||(0,S.b$)()||(0,S.d)()||(0,S.w1)()||(0,S.Mn)()||(0,S.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");Vr("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,h=!1;const l=new qu({Vi:e=>{h?Vr("Connection","Not sending because WebChannel is closed:",e):(u||(Vr("Connection","Opening WebChannel transport."),c.open(),u=!0),Vr("Connection","WebChannel sending:",e),c.send(e))},Si:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(c,Pr.EventType.OPEN,()=>{h||Vr("Connection","WebChannel transport opened.")}),d(c,Pr.EventType.CLOSE,()=>{h||(h=!0,Vr("Connection","WebChannel transport closed"),l.Oi())}),d(c,Pr.EventType.ERROR,e=>{h||(h=!0,jr("Connection","WebChannel transport errored:",e),l.Oi(new Wr($r.UNAVAILABLE,"The operation could not be completed")))}),d(c,Pr.EventType.MESSAGE,e=>{var t;if(!h){const n=e.data[0];Kr(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Vr("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=ho[e];if(void 0!==t)return po(t)}(e),n=i.message;void 0===t&&(t=$r.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),h=!0,l.Oi(new Wr(t,n)),c.close()}else Vr("Connection","WebChannel received:",n),l.Mi(n)}}),d(s,Cr.STAT_EVENT,e=>{e.stat===Rr.PROXY?Vr("Connection","Detected buffering proxy"):e.stat===Rr.NOPROXY&&Vr("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.$i()},0),l}}function Bu(){return"undefined"!=typeof window?window:null}function zu(){return"undefined"!=typeof document?document:null}function Ku(e){return new jo(e,!0)}class Gu{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&Vr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class $u{constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new Gu(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}async mr(){if(this.lr())return this.close(0)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}async close(e,t){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==e?this.ur.reset():t&&t.code===$r.RESOURCE_EXHAUSTED?(qr(t.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):t&&t.code===$r.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ni(t)}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.rr===t&&this.Ir(e,n)},t=>{e(()=>{const e=new Wr($r.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)})})}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{n(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(e=>{n(()=>this.Ar(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}dr(){this.state=5,this.ur.Zi(async()=>{this.state=0,this.start()})}Ar(e){return Vr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget(()=>this.rr===e?t():(Vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Wu extends $u{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:zr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.C?(Kr(void 0===t||"string"==typeof t),wi.fromBase64String(t||"")):(Kr(void 0===t||t instanceof Uint8Array),wi.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?$r.UNKNOWN:po(e.code);return new Wr(t,e.message||"")}(o);n=new Oo(r,i,s,a||null)}else if("documentChange"in t){const r=t.documentChange,i=Qo(e,r.document.name),s=Go(r.document.updateTime),o=new Gi({mapValue:{fields:r.document.fields}}),a=Wi.newFoundDocument(i,s,o);n=new Po(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=Qo(e,r.document),s=r.readTime?Go(r.readTime):hi.min(),o=Wi.newNoDocument(i,s);n=new Po([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=Qo(e,r.document);n=new Po([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return zr();{const e=t.filter,r=new uo(e.count||0);n=new xo(e.targetId,r)}}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return hi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?hi.min():t.readTime?Go(t.readTime):hi.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=Xo(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=Xi(r)?{documents:ia(e,r)}:{query:sa(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=zo(e,t.resumeToken):t.snapshotVersion.compareTo(hi.min())>0&&(n.readTime=Bo(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=Xo(this.k),t.removeTarget=e,this.gr(t)}}class Hu extends $u{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(Kr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(Kr(void 0!==t),e.map(e=>function(e,t){let n=Go(e.updateTime?e.updateTime:t);return n.isEqual(hi.min())&&(n=Go(t)),new Ws(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Go(e.commitTime);return this.listener.Cr(n,t)}return Kr(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=Xo(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>na(this.k,e))};this.gr(t)}}class Qu extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new Wr($r.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.Bi(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===$r.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Wr($r.UNKNOWN,e.toString())})}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.ji(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===$r.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Wr($r.UNKNOWN,e.toString())})}terminate(){this.$r=!0}}class Ju{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(qr(t),this.Lr=!1):Vr("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class Yu{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(e=>{n.enqueueAndForget(async()=>{oh(this)&&(Vr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Gr(e);t.Gr.add(4),await Zu(t),t.Jr.set("Unknown"),t.Gr.delete(4),await Xu(t)}(this))})}),this.Jr=new Ju(n,r)}}async function Xu(e){if(oh(e))for(const t of e.zr)await t(!0)}async function Zu(e){for(const t of e.zr)await t(!1)}function eh(e,t){const n=Gr(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),sh(n)?ih(n):Eh(n).lr()&&nh(n,t))}function th(e,t){const n=Gr(e),r=Eh(n);n.Wr.delete(t),r.lr()&&rh(n,t),0===n.Wr.size&&(r.lr()?r._r():oh(n)&&n.Jr.set("Unknown"))}function nh(e,t){e.Yr.X(t.targetId),Eh(e).Pr(t)}function rh(e,t){e.Yr.X(t),Eh(e).vr(t)}function ih(e){e.Yr=new Mo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),Eh(e).start(),e.Jr.Br()}function sh(e){return oh(e)&&!Eh(e).hr()&&e.Wr.size>0}function oh(e){return 0===Gr(e).Gr.size}function ah(e){e.Yr=void 0}async function ch(e){e.Wr.forEach((t,n)=>{nh(e,t)})}async function uh(e,t){ah(e),sh(e)?(e.Jr.Kr(t),ih(e)):e.Jr.set("Unknown")}async function hh(e,t,n){if(e.Jr.set("Online"),t instanceof Oo&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}(e,t)}catch(n){Vr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await lh(e,n)}else if(t instanceof Po?e.Yr.ot(t):t instanceof xo?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(hi.min()))try{const t=await cu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(wi.EMPTY_BYTE_STRING,n.snapshotVersion)),rh(e,t);const r=new tc(n.target,t,1,n.sequenceNumber);nh(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Vr("RemoteStore","Failed to raise snapshot:",t),await lh(e,t)}}async function lh(e,t,n){if(!$a(t))throw t;e.Gr.add(1),await Zu(e),e.Jr.set("Offline"),n||(n=()=>cu(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Vr("RemoteStore","Retrying IndexedDB access"),await n(),e.Gr.delete(1),await Xu(e)})}function dh(e,t){return t().catch(n=>lh(e,n,t))}async function fh(e){const t=Gr(e),n=kh(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;ph(t);)try{const e=await hu(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,gh(t,e)}catch(e){await lh(t,e)}mh(t)&&yh(t)}function ph(e){return oh(e)&&e.Qr.length<10}function gh(e,t){e.Qr.push(t);const n=kh(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function mh(e){return oh(e)&&!kh(e).hr()&&e.Qr.length>0}function yh(e){kh(e).start()}async function vh(e){kh(e).kr()}async function wh(e){const t=kh(e);for(const n of e.Qr)t.Dr(n.mutations)}async function Ih(e,t,n){const r=e.Qr.shift(),i=ec.from(r,t,n);await dh(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await fh(e)}async function Th(e,t){t&&kh(e).Sr&&await async function(e,t){if(fo(n=t.code)&&n!==$r.ABORTED){const n=e.Qr.shift();kh(e).wr(),await dh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await fh(e)}var n}(e,t),mh(e)&&yh(e)}async function _h(e,t){const n=Gr(e);n.asyncQueue.verifyOperationInProgress(),Vr("RemoteStore","RemoteStore received new credentials");const r=oh(n);n.Gr.add(3),await Zu(n),r&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),await Xu(n)}async function bh(e,t){const n=Gr(e);t?(n.Gr.delete(2),await Xu(n)):t||(n.Gr.add(2),await Zu(n),n.Jr.set("Unknown"))}function Eh(e){return e.Xr||(e.Xr=function(e,t,n){const r=Gr(e);return r.Or(),new Wu(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:ch.bind(null,e),Ni:uh.bind(null,e),br:hh.bind(null,e)}),e.zr.push(async t=>{t?(e.Xr.wr(),sh(e)?ih(e):e.Jr.set("Unknown")):(await e.Xr.stop(),ah(e))})),e.Xr}function kh(e){return e.Zr||(e.Zr=function(e,t,n){const r=Gr(e);return r.Or(),new Hu(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:vh.bind(null,e),Ni:Th.bind(null,e),Nr:wh.bind(null,e),Cr:Ih.bind(null,e)}),e.zr.push(async t=>{t?(e.Zr.wr(),await fh(e)):(await e.Zr.stop(),e.Qr.length>0&&(Vr("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))})),e.Zr}class Sh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Hr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Sh(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Wr($r.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ah(e,t){if(qr("AsyncQueue",`${t}: ${e}`),$a(e))return new Wr($r.UNAVAILABLE,`${t}: ${e}`);throw e}class Nh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ri.comparator(t.key,n.key):(e,t)=>Ri.comparator(e.key,t.key),this.keyedMap=bo(),this.sortedSet=new go(this.comparator)}static emptySet(e){return new Nh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Nh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Nh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ch{constructor(){this.eo=new go(Ri.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):zr():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,n)=>{e.push(n)}),e}}class Rh{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Rh(e,t,Nh.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ks(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Dh{constructor(){this.so=void 0,this.listeners=[]}}class Ph{constructor(){this.queries=new jc(e=>Ss(e),ks),this.onlineState="Unknown",this.io=new Set}}async function xh(e,t){const n=Gr(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Dh),i)try{s.so=await n.onListen(r)}catch(e){const n=Ah(e,`Initialization of query '${As(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&Fh(n)}async function Oh(e,t){const n=Gr(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Lh(e,t){const n=Gr(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.oo(i)&&(r=!0);e.so=i}}r&&Fh(n)}function Mh(e,t,n){const r=Gr(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function Fh(e){e.io.forEach(e=>{e.next()})}class Uh{constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Rh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=Rh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class Vh{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class qh{constructor(e){this.k=e}Hn(e){return Qo(this.k,e)}Jn(e){return e.metadata.exists?ta(this.k,e.document,!1):Wi.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return Go(e)}}class jh{constructor(e,t,n){this.mo=e,this.localStore=t,this.k=n,this.queries=[],this.documents=[],this.progress=Bh(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,n=new qh(this.k);for(const r of e)if(r.metadata.queries){const e=n.Hn(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Ao()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Gr(e);let s=Ao(),o=To(),a=ko();for(const h of n){const e=t.Hn(h.metadata.name);h.document&&(s=s.add(e)),o=o.insert(e,t.Jn(h)),a=a.insert(e,t.Yn(h.metadata.readTime))}const c=i.Qn.newChangeBuffer({trackRemovals:!0}),u=await lu(i,function(e){return bs(ms(gi.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>uu(e,c,o,hi.min(),a).next(t=>(c.apply(e),t)).next(t=>i.He.removeMatchingKeysForTargetId(e,u.targetId).next(()=>i.He.addMatchingKeys(e,s,u.targetId)).next(()=>i.Wn.Vn(e,t)).next(()=>t)))}(this.localStore,new qh(this.k),this.documents,this.mo.id),t=this.po(this.documents);for(const n of this.queries)await mu(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",new tu(Object.assign({},this.progress),e)}}function Bh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class zh{constructor(e){this.key=e}}class Kh{constructor(e){this.key=e}}class Gh{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=Ao(),this.mutatedKeys=Ao(),this.Ao=Cs(e),this.Ro=new Nh(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new Ch,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=ys(this.query)&&r.size===this.query.limit?r.last():null,c=vs(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),h=Ns(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Vo(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Ao(h,a)>0||c&&this.Ao(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),ys(this.query)||vs(this.query))for(;s.size>this.query.limit;){const e=ys(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zr()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc)),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new Rh(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Ch,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(e=>this.To=this.To.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.To=this.To.delete(e)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=Ao(),this.Ro.forEach(e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))});const t=[];return e.forEach(e=>{this.Io.has(e)||t.push(new Kh(e))}),this.Io.forEach(n=>{e.has(n)||t.push(new zh(n))}),t}ko(e){this.To=e.zn,this.Io=Ao();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return Rh.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class $h{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Wh{constructor(e){this.key=e,this.$o=!1}}class Hh{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new jc(e=>Ss(e),ks),this.Fo=new Map,this.Lo=new Set,this.Bo=new go(Ri.comparator),this.Uo=new Map,this.qo=new vu,this.Ko={},this.jo=new Map,this.Qo=Cc.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function Qh(e,t){const n=Tl(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=await lu(n.localStore,bs(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Jh(n,t,r,"current"===s),n.isPrimaryClient&&eh(n.remoteStore,e)}return i}async function Jh(e,t,n,r){e.Go=(t,n,r)=>async function(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=await fu(e.localStore,t.query,!1).then(({documents:e})=>t.view.Po(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return al(e,t.targetId,o.Co),o.snapshot}(e,t,n,r);const i=await fu(e.localStore,t,!0),s=new Gh(t,i.zn),o=s.Po(i.documents),a=Do.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);al(e,n,c.Co);const u=new $h(t,n,s);return e.Mo.set(t,u),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),c.snapshot}async function Yh(e,t){const n=Gr(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter(e=>!ks(e,t))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await du(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),th(n.remoteStore,r.targetId),sl(n,r.targetId)}).catch(Oc)):(sl(n,r.targetId),await du(n.localStore,r.targetId,!0))}async function Xh(e,t){const n=Gr(e);try{const e=await function(e,t){const n=Gr(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.He.addMatchingKeys(e,s.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(wi.EMPTY_BYTE_STRING,hi.min()).withLastLimboFreeSnapshotVersion(hi.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.He.updateTargetData(e,u))});let a=To();if(t.documentUpdates.forEach((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(uu(e,s,t.documentUpdates,r,void 0).next(e=>{a=e})),!r.isEqual(hi.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next(t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return ja.waitFor(o).next(()=>s.apply(e)).next(()=>n.Wn.Vn(e,a)).next(()=>a)}).then(e=>(n.qn=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Uo.get(t);r&&(Kr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?Kr(r.$o):e.removedDocuments.size>0&&(Kr(r.$o),r.$o=!1))}),await hl(n,e,t)}catch(e){await Oc(e)}}function Zh(e,t,n){const r=Gr(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=Gr(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)}),r&&Fh(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function el(e,t,n){const r=Gr(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new go(Ri.comparator);e=e.insert(s,Wi.newNoDocument(s,hi.min()));const n=Ao().add(s),i=new Ro(hi.min(),new Map,new vo(oi),e,n);await Xh(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),ul(r)}else await du(r.localStore,t,!1).then(()=>sl(r,t,n)).catch(Oc)}async function tl(e,t){const n=Gr(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Gr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ja.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);Kr(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),o.next(()=>e.An.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}(n.localStore,t);il(n,r,null),rl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await hl(n,e)}catch(e){await Oc(e)}}async function nl(e,t,n){const r=Gr(e);try{const e=await function(e,t){const n=Gr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.An.lookupMutationBatch(e,t).next(t=>(Kr(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t))).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}(r.localStore,t);il(r,t,n),rl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await hl(r,e)}catch(n){await Oc(n)}}function rl(e,t){(e.jo.get(t)||[]).forEach(e=>{e.resolve()}),e.jo.delete(t)}function il(e,t,n){const r=Gr(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function sl(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach(t=>{e.qo.containsKey(t)||ol(e,t)})}function ol(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(th(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),ul(e))}function al(e,t,n){for(const r of n)r instanceof zh?(e.qo.addReference(r.key,t),cl(e,r)):r instanceof Kh?(Vr("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||ol(e,r.key)):zr()}function cl(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(Vr("SyncEngine","New document in limbo: "+n),e.Lo.add(r),ul(e))}function ul(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new Ri(gi.fromString(t)),r=e.Qo.next();e.Uo.set(r,new Wh(n)),e.Bo=e.Bo.insert(n,r),eh(e.remoteStore,new tc(bs(ms(n.path)),r,2,ri.I))}}async function hl(e,t,n){const r=Gr(e),i=[],s=[],o=[];r.Mo.isEmpty()||(r.Mo.forEach((e,a)=>{o.push(r.Go(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=ru.$n(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.Oo.br(i),await async function(e,t){const n=Gr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ja.forEach(t,t=>ja.forEach(t.kn,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>ja.forEach(t.xn,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!$a(e))throw e;Vr("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.qn.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.qn=n.qn.insert(e,r)}}}(r.localStore,s))}async function ll(e,t){const n=Gr(e);if(!n.currentUser.isEqual(t)){Vr("SyncEngine","User change. New user:",t.toKey());const e=await au(n.localStore,t);n.currentUser=t,function(e,t){e.jo.forEach(e=>{e.forEach(e=>{e.reject(new Wr($r.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.jo.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await hl(n,e.Gn)}}function dl(e,t){const n=Gr(e),r=n.Uo.get(t);if(r&&r.$o)return Ao().add(r.key);{let e=Ao();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}async function fl(e,t){const n=Gr(e),r=await fu(n.localStore,t.query,!0),i=t.view.ko(r);return n.isPrimaryClient&&al(n,t.targetId,i.Co),i}async function pl(e){const t=Gr(e);return gu(t.localStore).then(e=>hl(t,e))}async function gl(e,t,n,r){const i=Gr(e),s=await function(e,t){const n=Gr(e),r=Gr(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.Zt(e,t).next(t=>t?n.Wn.vn(e,t):ja.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await fh(i.remoteStore):"acknowledged"===n||"rejected"===n?(il(i,t,r||null),rl(i,t),function(e,t){Gr(Gr(e).An).ee(t)}(i.localStore,t)):zr(),await hl(i,s)):Vr("SyncEngine","Cannot apply mutation batch with id: "+t)}async function ml(e,t,n){const r=Gr(e),i=[],s=[];for(const o of t){let e;const t=r.Fo.get(o);if(t&&0!==t.length){e=await lu(r.localStore,bs(t[0]));for(const e of t){const t=r.Mo.get(e),n=await fl(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await pu(r.localStore,o);e=await lu(r.localStore,t),await Jh(r,yl(t),o,!1)}i.push(e)}return r.Oo.br(s),i}function yl(e){return gs(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function vl(e){const t=Gr(e);return Gr(Gr(t.localStore).persistence).Tn()}async function wl(e,t,n,r){const i=Gr(e);if(i.Wo)Vr("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fo.has(t))switch(n){case"current":case"not-current":{const e=await gu(i.localStore),r=Ro.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await hl(i,e,r);break}case"rejected":await du(i.localStore,t,!0),sl(i,t,r);break;default:zr()}}async function Il(e,t,n){const r=Tl(e);if(r.Wo){for(const e of t){if(r.Fo.has(e)){Vr("SyncEngine","Adding an already active target "+e);continue}const t=await pu(r.localStore,e),n=await lu(r.localStore,t);await Jh(r,yl(t),n.targetId,!1),eh(r.remoteStore,n)}for(const e of n)r.Fo.has(e)&&await du(r.localStore,e,!1).then(()=>{th(r.remoteStore,e),sl(r,e)}).catch(Oc)}}function Tl(e){const t=Gr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Xh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=dl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=el.bind(null,t),t.Oo.br=Lh.bind(null,t.eventManager),t.Oo.zo=Mh.bind(null,t.eventManager),t}function _l(e){const t=Gr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=tl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=nl.bind(null,t),t}class bl{constructor(){this.synchronizeTabs=!1}async initialize(e){this.k=Ku(e.databaseInfo.databaseId),this.sharedClientState=this.Jo(e),this.persistence=this.Yo(e),await this.persistence.start(),this.gcScheduler=this.Xo(e),this.localStore=this.Zo(e)}Xo(e){return null}Zo(e){return ou(this.persistence,new iu,e.initialUser,this.k)}Yo(e){return new Eu(Su.ks,this.k)}Jo(e){return new Mu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class El extends bl{constructor(e,t,n){super(),this.tc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=Gr(e);return t.persistence.runTransaction("Synchronize last document change read time","readonly",e=>function(e){const t=$c(e);let n=hi.min();return t.jt({index:Ca.readTimeIndex,reverse:!0},(e,t,r)=>{t.readTime&&(n=oc(t.readTime)),r.done()}).next(()=>n)}(e)).then(e=>{t.jn=e})}(this.localStore),await this.tc.initialize(this,e),await _l(this.tc.syncEngine),await fh(this.tc.remoteStore),await this.persistence.sn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Zo(e){return ou(this.persistence,new iu,e.initialUser,this.k)}Xo(e){return new Fc(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Yo(e){const t=eu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Tc.withCacheSize(this.cacheSizeBytes):Tc.DEFAULT;return new Yc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Bu(),zu(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new Mu}}class kl extends El{constructor(e,t){super(e,t,!1),this.tc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.tc.syncEngine;this.sharedClientState instanceof Lu&&(this.sharedClientState.syncEngine={mi:gl.bind(null,t),gi:wl.bind(null,t),yi:Il.bind(null,t),Tn:vl.bind(null,t),_i:pl.bind(null,t)},await this.sharedClientState.start()),await this.persistence.sn(async e=>{await async function(e,t){const n=Gr(e);if(Tl(n),_l(n),!0===t&&!0!==n.Wo){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await ml(n,e.toArray());n.Wo=!0,await bh(n.remoteStore,!0);for(const r of t)eh(n.remoteStore,r)}else if(!1===t&&!1!==n.Wo){const e=[];let t=Promise.resolve();n.Fo.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(sl(n,i),du(n.localStore,i,!0))),th(n.remoteStore,i)}),await t,await ml(n,e),function(e){const t=Gr(e);t.Uo.forEach((e,n)=>{th(t.remoteStore,n)}),t.qo.hs(),t.Uo=new Map,t.Bo=new go(Ri.comparator)}(n),n.Wo=!1,await bh(n.remoteStore,!1)}}(this.tc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Jo(e){const t=Bu();if(!Lu.Pt(t))throw new Wr($r.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=eu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Lu(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Sl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Zh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ll.bind(null,this.syncEngine),await bh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ph}createDatastore(e){const t=Ku(e.databaseInfo.databaseId),n=new ju(e.databaseInfo);return function(e,t,n,r){return new Qu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Zh(this.syncEngine,e,0),s=Uu.Pt()?new Uu:new Fu,new Yu(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Hh(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Gr(e);Vr("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),await Zu(t),t.Hr.shutdown(),t.Jr.set("Unknown")}(this.remoteStore)}}function Al(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Nl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Cl{constructor(e,t){this.sc=e,this.k=t,this.metadata=new Hr,this.buffer=new Uint8Array,this.ic=new TextDecoder("utf-8"),this.rc().then(e=>{e&&e._o()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.sc.cancel()}async getMetadata(){return this.metadata.promise}async Ho(){return await this.getMetadata(),this.rc()}async rc(){const e=await this.oc();if(null===e)return null;const t=this.ic.decode(e),n=Number(t);isNaN(n)&&this.cc(`length string (${t}) is not valid number`);const r=await this.ac(n);return new Vh(JSON.parse(r),e.length+n)}uc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async oc(){for(;this.uc()<0&&!(await this.hc()););if(0===this.buffer.length)return null;const e=this.uc();e<0&&this.cc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ac(e){for(;this.buffer.length<e;)await this.hc()&&this.cc("Reached the end of bundle when more is expected.");const t=this.ic.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}cc(e){throw this.sc.cancel(),new Error(`Invalid bundle format: ${e}`)}async hc(){const e=await this.sc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Rl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Wr($r.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Gr(e),r=Xo(n.k)+"/documents",i={documents:t.map(e=>Ho(n.k,e))},s=await n.ji("BatchGetDocuments",r,i),o=new Map;s.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){Kr(!!t.found);const n=Qo(e,t.found.name),r=Go(t.found.updateTime),i=new Gi({mapValue:{fields:t.found.fields}});return Wi.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Kr(!!t.missing),Kr(!!t.readTime);const n=Qo(e,t.missing),r=Go(t.readTime);return Wi.newNoDocument(n,r)}(e,t):zr()}(n.k,e);o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=o.get(e.toString());Kr(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new ao(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=Ri.fromPath(t);this.mutations.push(new co(n,this.precondition(n)))}),await async function(e,t){const n=Gr(e),r=Xo(n.k)+"/documents",i={writes:t.map(e=>na(n.k,e))};await n.Bi("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw zr();t=hi.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Wr($r.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Hs.updateTime(t):Hs.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(hi.min()))throw new Wr($r.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Hs.updateTime(t)}return Hs.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Dl{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.lc=5,this.ur=new Gu(this.asyncQueue,"transaction_retry")}run(){this.lc-=1,this.fc()}fc(){this.ur.Zi(async()=>{const e=new Rl(this.datastore),t=this.dc(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.wc(e)}))}).catch(e=>{this.wc(e)})})}dc(e){try{const t=this.updateFunction(e);return!Ai(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}wc(e){this.lc>0&&this._c(e)?(this.lc-=1,this.asyncQueue.enqueueAndForget(()=>(this.fc(),Promise.resolve()))):this.deferred.reject(e)}_c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!fo(t)}return!1}}class Pl{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Lr.UNAUTHENTICATED,this.clientId=si.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{Vr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Vr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Wr($r.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Hr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ah(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function xl(e,t){e.asyncQueue.verifyOperationInProgress(),Vr("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await au(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function Ol(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Ll(e);Vr("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>_h(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>_h(t.remoteStore,n)),e.onlineComponents=t}async function Ll(e){return e.offlineComponents||(Vr("FirestoreClient","Using default OfflineComponentProvider"),await xl(e,new bl)),e.offlineComponents}async function Ml(e){return e.onlineComponents||(Vr("FirestoreClient","Using default OnlineComponentProvider"),await Ol(e,new Sl)),e.onlineComponents}function Fl(e){return Ll(e).then(e=>e.persistence)}function Ul(e){return Ll(e).then(e=>e.localStore)}function Vl(e){return Ml(e).then(e=>e.remoteStore)}function ql(e){return Ml(e).then(e=>e.syncEngine)}async function jl(e){const t=await Ml(e),n=t.eventManager;return n.onListen=Qh.bind(null,t.syncEngine),n.onUnlisten=Yh.bind(null,t.syncEngine),n}function Bl(e,t,n={}){const r=new Hr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Nl({next:s=>{t.enqueueAndForget(()=>Oh(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Wr($r.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Wr($r.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Uh(ms(n.path),s,{includeMetadataChanges:!0,wo:!0});return xh(e,o)}(await jl(e),e.asyncQueue,t,n,r)),r.promise}function zl(e,t,n={}){const r=new Hr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Nl({next:n=>{t.enqueueAndForget(()=>Oh(e,o)),n.fromCache&&"server"===r.source?i.reject(new Wr($r.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Uh(n,s,{includeMetadataChanges:!0,wo:!0});return xh(e,o)}(await jl(e),e.asyncQueue,t,n,r)),r.promise}class Kl{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Gl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gl&&e.projectId===this.projectId&&e.database===this.database}}const $l=new Map;function Wl(e,t,n){if(!n)throw new Wr($r.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Hl(e,t,n,r){if(!0===t&&!0===r)throw new Wr($r.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ql(e){if(!Ri.isDocumentKey(e))throw new Wr($r.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Jl(e){if(Ri.isDocumentKey(e))throw new Wr($r.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Yl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":zr()}function Xl(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Wr($r.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yl(e);throw new Wr($r.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Zl(e,t){if(t<=0)throw new Wr($r.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class ed{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Wr($r.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Wr($r.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Hl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class td{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ed({}),this._settingsFrozen=!1,e instanceof Gl?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Wr($r.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gl(e.options.projectId)}(e))}get app(){if(!this._app)throw new Wr($r.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Wr($r.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ed(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Jr;switch(e.type){case"gapi":const t=e.client;return Kr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new ei(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Wr($r.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=$l.get(e);t&&(Vr("ComponentProvider","Removing Datastore"),$l.delete(e),t.terminate())}(this),Promise.resolve()}}class nd{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new id(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new nd(this.firestore,e,this._key)}}class rd{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new rd(this.firestore,e,this._query)}}class id extends rd{constructor(e,t,n){super(e,t,ms(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new nd(this.firestore,null,new Ri(e))}withConverter(e){return new id(this.firestore,e,this._path)}}function sd(e,t,...n){if(e=(0,S.m9)(e),Wl("collection","path",t),e instanceof td){const r=gi.fromString(t,...n);return Jl(r),new id(e,null,r)}{if(!(e instanceof nd||e instanceof id))throw new Wr($r.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(gi.fromString(t,...n));return Jl(r),new id(e.firestore,null,r)}}function od(e,t,...n){if(e=(0,S.m9)(e),1===arguments.length&&(t=si.A()),Wl("doc","path",t),e instanceof td){const r=gi.fromString(t,...n);return Ql(r),new nd(e,null,new Ri(r))}{if(!(e instanceof nd||e instanceof id))throw new Wr($r.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(gi.fromString(t,...n));return Ql(r),new nd(e.firestore,e instanceof id?e.converter:null,new Ri(r))}}function ad(e,t){return e=(0,S.m9)(e),t=(0,S.m9)(t),(e instanceof nd||e instanceof id)&&(t instanceof nd||t instanceof id)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function cd(e,t){return e=(0,S.m9)(e),t=(0,S.m9)(t),e instanceof rd&&t instanceof rd&&e.firestore===t.firestore&&ks(e._query,t._query)&&e.converter===t.converter}class ud{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new Gu(this,"async_queue_retry"),this.bc=()=>{const e=zu();e&&Vr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=zu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=zu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise(()=>{});const t=new Hr;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.gc.push(e),this.Vc()))}async Vc(){if(0!==this.gc.length){try{await this.gc[0](),this.gc.shift(),this.ur.reset()}catch(q){if(!$a(q))throw q;Vr("AsyncQueue","Operation failed with retryable error: "+q)}this.gc.length>0&&this.ur.Zi(()=>this.Vc())}}vc(e){const t=this.mc.then(()=>(this.Ic=!0,e().catch(e=>{throw this.Ec=e,this.Ic=!1,qr("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Ic=!1,e))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=Sh.createAndSchedule(this,e,t,n,e=>this.Sc(e));return this.Tc.push(r),r}Pc(){this.Ec&&zr()}verifyOperationInProgress(){}async Dc(){let e;do{e=this.mc,await e}while(e!==this.mc)}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then(()=>{this.Tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()})}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function hd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class ld{constructor(){this._progressObserver={},this._taskCompletionResolver=new Hr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class dd extends td{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new ud,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||pd(this),this._firestoreClient.terminate()}}function fd(e){return e._firestoreClient||pd(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function pd(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Kl(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Pl(e._authCredentials,e._appCheckCredentials,e._queue,r)}function gd(e,t,n){const r=new Hr;return e.asyncQueue.enqueue(async()=>{try{await xl(e,n),await Ol(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===$r.FAILED_PRECONDITION||e.code===$r.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}}).then(()=>r.promise)}function md(e){if(e._initialized||e._terminated)throw new Wr($r.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class yd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Wr($r.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class vd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vd(wi.fromBase64String(e))}catch(e){throw new Wr($r.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vd(wi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class wd{constructor(e){this._methodName=e}}class Id{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Wr($r.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Wr($r.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return oi(this._lat,e._lat)||oi(this._long,e._long)}}const Td=/^__.*__$/;class _d{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ro(e,this.data,this.fieldMask,t,this.fieldTransforms):new no(e,this.data,t,this.fieldTransforms)}}class bd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ro(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ed(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zr()}}class kd{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new kd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return Gd(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(Ed(this.$c)&&Td.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class Sd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||Ku(e)}Qc(e,t,n,r=!1){return new kd({$c:e,methodName:t,jc:n,path:yi.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function Ad(e){const t=e._freezeSettings(),n=Ku(e._databaseId);return new Sd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Nd(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);jd("Data must be an object, but it was:",o,r);const a=Vd(r,o);let c,u;if(s.merge)c=new vi(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Bd(t,r,n);if(!o.contains(i))throw new Wr($r.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);$d(e,i)||e.push(i)}c=new vi(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new _d(new Gi(a),c,u)}class Cd extends wd{_toFieldTransform(e){if(2!==e.$c)throw e.qc(1===e.$c?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Cd}}function Rd(e,t,n){return new kd({$c:3,jc:t.settings.jc,methodName:e._methodName,Fc:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}class Dd extends wd{_toFieldTransform(e){return new $s(e.path,new Us)}isEqual(e){return e instanceof Dd}}class Pd extends wd{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=Rd(this,e,!0),n=this.Wc.map(e=>Ud(e,t)),r=new Vs(n);return new $s(e.path,r)}isEqual(e){return this===e}}class xd extends wd{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=Rd(this,e,!0),n=this.Wc.map(e=>Ud(e,t)),r=new js(n);return new $s(e.path,r)}isEqual(e){return this===e}}class Od extends wd{constructor(e,t){super(e),this.Gc=t}_toFieldTransform(e){const t=new zs(e.k,xs(e.k,this.Gc));return new $s(e.path,t)}isEqual(e){return this===e}}function Ld(e,t,n,r){const i=e.Qc(1,t,n);jd("Data must be an object, but it was:",i,r);const s=[],o=Gi.empty();di(r,(e,r)=>{const a=Kd(t,e,n);r=(0,S.m9)(r);const c=i.Bc(a);if(r instanceof Cd)s.push(a);else{const e=Ud(r,c);null!=e&&(s.push(a),o.set(a,e))}});const a=new vi(s);return new bd(o,a,i.fieldTransforms)}function Md(e,t,n,r,i,s){const o=e.Qc(1,t,n),a=[Bd(t,r,n)],c=[i];if(s.length%2!=0)throw new Wr($r.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Bd(t,s[d])),c.push(s[d+1]);const u=[],h=Gi.empty();for(let d=a.length-1;d>=0;--d)if(!$d(u,a[d])){const e=a[d];let t=c[d];t=(0,S.m9)(t);const n=o.Bc(e);if(t instanceof Cd)u.push(e);else{const r=Ud(t,n);null!=r&&(u.push(e),h.set(e,r))}}const l=new vi(u);return new bd(h,l,o.fieldTransforms)}function Fd(e,t,n,r=!1){return Ud(n,e.Qc(r?4:3,t))}function Ud(e,t){if(qd(e=(0,S.m9)(e)))return jd("Unsupported field value:",t,e),Vd(e,t);if(e instanceof wd)return function(e,t){if(!Ed(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Ud(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,S.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return xs(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ui.fromDate(e);return{timestampValue:Bo(t.k,n)}}if(e instanceof ui){const n=new ui(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Bo(t.k,n)}}if(e instanceof Id)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof vd)return{bytesValue:zo(t.k,e._byteString)};if(e instanceof nd){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:$o(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${Yl(e)}`)}(e,t)}function Vd(e,t){const n={};return fi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):di(e,(e,r)=>{const i=Ud(r,t.Mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function qd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ui||e instanceof Id||e instanceof vd||e instanceof nd||e instanceof wd)}function jd(e,t,n){if(!qd(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Yl(n);throw t.qc("an object"===r?e+" a custom object":e+" "+r)}}function Bd(e,t,n){if((t=(0,S.m9)(t))instanceof yd)return t._internalPath;if("string"==typeof t)return Kd(e,t);throw Gd("Field path arguments must be of type string or ",e,!1,void 0,n)}const zd=new RegExp("[~\\*/\\[\\]]");function Kd(e,t,n){if(t.search(zd)>=0)throw Gd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new yd(...t.split("."))._internalPath}catch(r){throw Gd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Gd(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Wr($r.INVALID_ARGUMENT,a+e+c)}function $d(e,t){return e.some(e=>e.isEqual(t))}class Wd{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new nd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Hd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Qd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Hd extends Wd{data(){return super.data()}}function Qd(e,t){return"string"==typeof t?Kd(e,t):t instanceof yd?t._internalPath:t._delegate._internalPath}class Jd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Yd extends Wd{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Qd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Xd extends Yd{data(e={}){return super.data(e)}}class Zd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Jd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Xd(this._firestore,this._userDataWriter,n.key,n,new Jd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Wr($r.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new Xd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Jd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Xd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Jd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:ef(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ef(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zr()}}function tf(e,t){return e instanceof Yd&&t instanceof Yd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Zd&&t instanceof Zd&&e._firestore===t._firestore&&cd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function nf(e){if(vs(e)&&0===e.explicitOrderBy.length)throw new Wr($r.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rf{}function sf(e,...t){for(const n of t)e=n._apply(e);return e}class of extends rf{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=Ad(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Wr($r.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ff(o,s);const t=[];for(const n of o)t.push(df(r,e,n));a={arrayValue:{values:t}}}else a=df(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ff(o,s),a=Fd(n,"where",o,"in"===s||"not-in"===s);const c=Zi.create(i,s,a);return function(e,t){if(t.V()){const n=Is(e);if(null!==n&&!n.isEqual(t.field))throw new Wr($r.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=ws(e);null!==r&&pf(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new Wr($r.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new rd(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new ps(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}class af extends rf{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Wr($r.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Wr($r.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new hs(t,n);return function(e,t){if(null===ws(e)){const n=Is(e);null!==n&&pf(0,n,t.field)}}(e,r),r}(e._query,this.zc,this.Yc);return new rd(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ps(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class cf extends rf{constructor(e,t,n){super(),this.type=e,this.Xc=t,this.Zc=n}_apply(e){return new rd(e.firestore,e.converter,Es(e._query,this.Xc,this.Zc))}}class uf extends rf{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){const t=lf(e,this.type,this.ta,this.ea);return new rd(e.firestore,e.converter,function(e,t){return new ps(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class hf extends rf{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){const t=lf(e,this.type,this.ta,this.ea);return new rd(e.firestore,e.converter,function(e,t){return new ps(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function lf(e,t,n,r){if(n[0]=(0,S.m9)(n[0]),n[0]instanceof Wd)return function(e,t,n,r,i){if(!r)throw new Wr($r.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of _s(e))if(o.field.isKeyField())s.push(Ui(t,r.key));else{const e=r.data.field(o.field);if(Ei(e))throw new Wr($r.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new Wr($r.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new cs(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Ad(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Wr($r.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new Wr($r.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof s}`);if(!Ts(e)&&-1!==s.indexOf("/"))throw new Wr($r.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(gi.fromString(s));if(!Ri.isDocumentKey(n))throw new Wr($r.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Ri(n);a.push(Ui(t,i))}else{const e=Fd(n,r,s);a.push(e)}}return new cs(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function df(e,t,n){if("string"==typeof(n=(0,S.m9)(n))){if(""===n)throw new Wr($r.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ts(t)&&-1!==n.indexOf("/"))throw new Wr($r.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(gi.fromString(n));if(!Ri.isDocumentKey(r))throw new Wr($r.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ui(e,new Ri(r))}if(n instanceof nd)return Ui(e,n._key);throw new Wr($r.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yl(n)}.`)}function ff(e,t){if(!Array.isArray(e)||0===e.length)throw new Wr($r.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new Wr($r.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function pf(e,t,n){if(!n.isEqual(t))throw new Wr($r.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class gf{convertValue(e,t="none"){switch(Di(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _i(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw zr()}}convertObject(e,t){const n={};return di(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new Id(_i(e.latitude),_i(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ki(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Si(e));default:return null}}convertTimestamp(e){const t=Ti(e);return new ui(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=gi.fromString(e);Kr(ya(n));const r=new Gl(n.get(1),n.get(3)),i=new Ri(n.popFirst(5));return r.isEqual(t)||qr(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function mf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class yf extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new vd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nd(this.firestore,null,t)}}class vf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ad(e)}set(e,t,n){this._verifyNotCommitted();const r=wf(e,this._firestore),i=mf(r.converter,t,n),s=Nd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Hs.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=wf(e,this._firestore);let s;return s="string"==typeof(t=(0,S.m9)(t))||t instanceof yd?Md(this._dataReader,"WriteBatch.update",i._key,t,n,r):Ld(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Hs.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=wf(e,this._firestore);return this._mutations=this._mutations.concat(new ao(t._key,Hs.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Wr($r.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function wf(e,t){if((e=(0,S.m9)(e)).firestore!==t)throw new Wr($r.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class If extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new vd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nd(this.firestore,null,t)}}function Tf(e,t,n){e=Xl(e,nd);const r=Xl(e.firestore,dd),i=mf(e.converter,t,n);return Ef(r,[Nd(Ad(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Hs.none())])}function _f(e,t,n,...r){e=Xl(e,nd);const i=Xl(e.firestore,dd),s=Ad(i);let o;return o="string"==typeof(t=(0,S.m9)(t))||t instanceof yd?Md(s,"updateDoc",e._key,t,n,r):Ld(s,"updateDoc",e._key,t),Ef(i,[o.toMutation(e._key,Hs.exists(!0))])}function bf(e,...t){var n,r,i;e=(0,S.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||hd(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(hd(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,h;if(e instanceof nd)u=Xl(e.firestore,dd),h=ms(e._key.path),c={next:n=>{t[o]&&t[o](kf(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Xl(e,rd);u=Xl(n.firestore,dd),h=n._query;const r=new If(u);c={next:e=>{t[o]&&t[o](new Zd(u,r,n,e))},error:t[o+1],complete:t[o+2]},nf(e._query)}return function(e,t,n,r){const i=new Nl(r),s=new Uh(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>xh(await jl(e),s)),()=>{i.nc(),e.asyncQueue.enqueueAndForget(async()=>Oh(await jl(e),s))}}(fd(u),h,a,c)}function Ef(e,t){return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=_l(e);try{const e=await function(e,t){const n=Gr(e),r=ui.now(),i=t.reduce((e,t)=>e.add(t.key),Ao());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Wn.vn(e,i).next(i=>{s=i;const o=[];for(const e of t){const t=Zs(e,s.get(e.key));null!=t&&o.push(new ro(e.key,t,$i(t.value.mapValue),Hs.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new go(oi)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),await hl(r,e.changes),await fh(r.remoteStore)}catch(e){const t=Ah(e,"Failed to persist write");n.reject(t)}}(await ql(e),t,n)),n.promise}(fd(e),t)}function kf(e,t,n){const r=n.docs.get(t._key),i=new If(e);return new Yd(e,i,t._key,r,new Jd(n.hasPendingWrites,n.fromCache),t.converter)}class Sf extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ad(e)}get(e){const t=wf(e,this._firestore),n=new yf(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return zr();const r=e[0];if(r.isFoundDocument())return new Wd(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Wd(this._firestore,n,t._key,null,t.converter);throw zr()})}set(e,t,n){const r=wf(e,this._firestore),i=mf(r.converter,t,n),s=Nd(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=wf(e,this._firestore);let s;return s="string"==typeof(t=(0,S.m9)(t))||t instanceof yd?Md(this._dataReader,"Transaction.update",i._key,t,n,r):Ld(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=wf(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=wf(e,this._firestore),n=new If(this._firestore);return super.get(e).then(e=>new Yd(this._firestore,n,t._key,e._document,new Jd(!1,!1),t.converter))}}function Af(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Wr("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function Nf(){if("undefined"==typeof Uint8Array)throw new Wr("unimplemented","Uint8Arrays are not available in this environment.")}function Cf(){if("undefined"==typeof atob)throw new Wr("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){!function(e){Mr=e}(b.SDK_VERSION),(0,b._registerComponent)(new E.wA("firestore",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new dd(r,new Xr(e.getProvider("auth-internal")),new ni(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC")),(0,b.registerVersion)(Or,"3.4.4",e),(0,b.registerVersion)(Or,"3.4.4","esm2017")}();class Rf{constructor(e){this._delegate=e}static fromBase64String(e){return Cf(),new Rf(vd.fromBase64String(e))}static fromUint8Array(e){return Nf(),new Rf(vd.fromUint8Array(e))}toBase64(){return Cf(),this._delegate.toBase64()}toUint8Array(){return Nf(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Df(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class Pf{enableIndexedDbPersistence(e,t){return function(e,t){md(e=Xl(e,dd));const n=fd(e),r=e._freezeSettings(),i=new Sl;return gd(n,i,new El(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){md(e=Xl(e,dd));const t=fd(e),n=e._freezeSettings(),r=new Sl;return gd(t,r,new kl(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Wr($r.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Hr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!za.Pt())return Promise.resolve();const t=e+"main";await za.delete(t)}(eu(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class xf{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Gl||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||jr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=Xl(e,td))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&jr("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Lr.MOCK_USER;else{t=(0,S.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Wr($r.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Lr(s)}e._authCredentials=new Yr(new Qr(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await Fl(e),n=await Vl(e);return t.setNetworkEnabled(!0),function(e){const t=Gr(e);return t.Gr.delete(0),Xu(t)}(n)})}(fd(e=Xl(e,dd)))}(this._delegate)}disableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await Fl(e),n=await Vl(e);return t.setNetworkEnabled(!1),async function(e){const t=Gr(e);t.Gr.add(0),await Zu(t),t.Jr.set("Offline")}(n)})}(fd(e=Xl(e,dd)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Hl("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){return function(e){const t=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=Gr(e);oh(n.remoteStore)||Vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Gr(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.An.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(-1===e)return void t.resolve();const r=n.jo.get(e)||[];r.push(t),n.jo.set(e,r)}catch(e){const n=Ah(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await ql(e),t)),t.promise}(fd(e=Xl(e,dd)))}(this._delegate)}onSnapshotsInSync(e){return function(e,t){return function(e,t){const n=new Nl(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){Gr(e).io.add(t),t.next()}(await jl(e),n)),()=>{n.nc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){Gr(e).io.delete(t)}(await jl(e),n))}}(fd(e=Xl(e,dd)),hd(t)?t:{next:t})}(this._delegate,e)}get app(){if(!this._appCompat)throw new Wr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Wf(this,sd(this._delegate,e))}catch(t){throw Vf(t,"collection()","Firestore.collection()")}}doc(e){try{return new Uf(this,od(this._delegate,e))}catch(t){throw Vf(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Kf(this,function(e,t){if(e=Xl(e,td),Wl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Wr($r.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new rd(e,null,function(e){return new ps(gi.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw Vf(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t){return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>{const r=await function(e){return Ml(e).then(e=>e.datastore)}(e);new Dl(e.asyncQueue,r,t,n).run()}),n.promise}(fd(e=Xl(e,dd)),n=>t(new Sf(e,n)))}(this._delegate,t=>e(new Lf(this,t)))}batch(){return fd(this._delegate),new Mf(new vf(this._delegate,e=>Ef(this._delegate,e)))}loadBundle(e){return function(e,t){const n=fd(e=Xl(e,dd)),r=new ld;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new Cl(e,t)}(function(e,t){if(e instanceof Uint8Array)return Al(e,t);if(e instanceof ArrayBuffer)return Al(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Ku(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=Gr(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Gr(e),r=Go(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ye.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}(e.localStore,r))return await t.close(),void n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r));n._updateProgress(Bh(r));const i=new jh(r,e.localStore,t.k);let s=await t.Ho();for(;s;){const e=await i.yo(s);e&&n._updateProgress(e),s=await t.Ho()}const o=await i.complete();await hl(e,o.In,void 0),await function(e,t){const n=Gr(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ye.saveBundleMetadata(e,t))}(e.localStore,r),n._completeWith(o.progress)}catch(e){jr("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e)}})(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await ql(e),i,r)})}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return function(e,t){return function(e,t){return e.asyncQueue.enqueue(async()=>function(e,t){const n=Gr(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.Ye.getNamedQuery(e,t))}(await Ul(e),t))}(fd(e=Xl(e,dd)),t).then(t=>t?new rd(e,null,t.query):null)}(this._delegate,e).then(e=>e?new Kf(this,e):null)}}class Of extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rf(new vd(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Uf.forKey(t,this.firestore,null)}}class Lf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Of(e)}get(e){const t=Hf(e);return this._delegate.get(t).then(e=>new Bf(this._firestore,new Yd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){const r=Hf(e);return n?(Af("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Hf(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Hf(e);return this._delegate.delete(t),this}}class Mf{constructor(e){this._delegate=e}set(e,t,n){const r=Hf(e);return n?(Af("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Hf(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Hf(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Ff{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Xd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new zf(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Ff.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Ff(e,new Of(e),t),r.set(t,i)),i}}Ff.INSTANCES=new WeakMap;class Uf{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Of(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Wr("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Uf(t,new nd(t._delegate,n,new Ri(e)))}static forKey(e,t,n){return new Uf(t,new nd(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Wf(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Wf(this.firestore,sd(this._delegate,e))}catch(t){throw Vf(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,S.m9)(e))instanceof nd&&ad(this._delegate,e)}set(e,t){t=Af("DocumentReference.set",t);try{return t?Tf(this._delegate,e,t):Tf(this._delegate,e)}catch(n){throw Vf(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?_f(this._delegate,e):_f(this._delegate,e,t,...n)}catch(r){throw Vf(r,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return Ef(Xl(e.firestore,dd),[new ao(e._key,Hs.none())])}(this._delegate)}onSnapshot(...e){const t=qf(e),n=jf(e,e=>new Bf(this.firestore,new Yd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return bf(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Xl(e,nd);const t=Xl(e.firestore,dd),n=fd(t),r=new If(t);return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(e,t){const n=Gr(e);return n.persistence.runTransaction("read document","readonly",e=>n.Wn.Rn(e,t))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Wr($r.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Ah(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Ul(e),t,n)),n.promise}(n,e._key).then(n=>new Yd(t,r,e._key,n,new Jd(null!==n&&n.hasLocalMutations,!0),e.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Xl(e,nd);const t=Xl(e.firestore,dd);return Bl(fd(t),e._key,{source:"server"}).then(n=>kf(t,e,n))}(this._delegate):function(e){e=Xl(e,nd);const t=Xl(e.firestore,dd);return Bl(fd(t),e._key).then(n=>kf(t,e,n))}(this._delegate),t.then(e=>new Bf(this.firestore,new Yd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Uf(this.firestore,this._delegate.withConverter(e?Ff.getInstance(this.firestore,e):null))}}function Vf(e,t,n){return e.message=e.message.replace(t,n),e}function qf(e){for(const t of e)if("object"==typeof t&&!Df(t))return t;return{}}function jf(e,t){var n,r;let i;return i=Df(e[0])?e[0]:Df(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Bf{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Uf(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return tf(this._delegate,e._delegate)}}class zf extends Bf{data(e){const t=this._delegate.data(e);return function(e,t){e||zr()}(void 0!==t),t}}class Kf{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Of(e)}where(e,t,n){try{return new Kf(this.firestore,sf(this._delegate,function(e,t,n){const r=t,i=Qd("where",e);return new of(i,r,n)}(e,t,n)))}catch(r){throw Vf(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Kf(this.firestore,sf(this._delegate,function(e,t="asc"){const n=t,r=Qd("orderBy",e);return new af(r,n)}(e,t)))}catch(n){throw Vf(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Kf(this.firestore,sf(this._delegate,function(e){return Zl("limit",e),new cf("limit",e,"F")}(e)))}catch(t){throw Vf(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Kf(this.firestore,sf(this._delegate,function(e){return Zl("limitToLast",e),new cf("limitToLast",e,"L")}(e)))}catch(t){throw Vf(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Kf(this.firestore,sf(this._delegate,function(...e){return new uf("startAt",e,!0)}(...e)))}catch(t){throw Vf(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Kf(this.firestore,sf(this._delegate,function(...e){return new uf("startAfter",e,!1)}(...e)))}catch(t){throw Vf(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Kf(this.firestore,sf(this._delegate,function(...e){return new hf("endBefore",e,!0)}(...e)))}catch(t){throw Vf(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Kf(this.firestore,sf(this._delegate,function(...e){return new hf("endAt",e,!1)}(...e)))}catch(t){throw Vf(t,"endAt()","Query.endAt()")}}isEqual(e){return cd(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Xl(e,rd);const t=Xl(e.firestore,dd),n=fd(t),r=new If(t);return function(e,t){const n=new Hr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await fu(e,t,!0),i=new Gh(t,r.zn),s=i.Po(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Ah(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Ul(e),t,n)),n.promise}(n,e._query).then(n=>new Zd(t,r,e,n))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Xl(e,rd);const t=Xl(e.firestore,dd),n=fd(t),r=new If(t);return zl(n,e._query,{source:"server"}).then(n=>new Zd(t,r,e,n))}(this._delegate):function(e){e=Xl(e,rd);const t=Xl(e.firestore,dd),n=fd(t),r=new If(t);return nf(e._query),zl(n,e._query).then(n=>new Zd(t,r,e,n))}(this._delegate),t.then(e=>new $f(this.firestore,new Zd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){const t=qf(e),n=jf(e,e=>new $f(this.firestore,new Zd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return bf(this._delegate,t,n)}withConverter(e){return new Kf(this.firestore,this._delegate.withConverter(e?Ff.getInstance(this.firestore,e):null))}}class Gf{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new zf(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class $f{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Kf(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new zf(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Gf(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new zf(this._firestore,n))})}isEqual(e){return tf(this._delegate,e._delegate)}}class Wf extends Kf{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Uf(this.firestore,e):null}doc(e){try{return new Uf(this.firestore,void 0===e?od(this._delegate):od(this._delegate,e))}catch(t){throw Vf(t,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Xl(e.firestore,dd),r=od(e),i=mf(e.converter,t);return Ef(n,[Nd(Ad(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Hs.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Uf(this.firestore,e))}isEqual(e){return ad(this._delegate,e._delegate)}withConverter(e){return new Wf(this.firestore,this._delegate.withConverter(e?Ff.getInstance(this.firestore,e):null))}}function Hf(e){return Xl(e,nd)}class Qf{constructor(...e){this._delegate=new yd(...e)}static documentId(){return new Qf(yi.keyField().canonicalString())}isEqual(e){return(e=(0,S.m9)(e))instanceof yd&&this._delegate._internalPath.isEqual(e._internalPath)}}class Jf{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Dd("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Jf(e)}static delete(){const e=new Cd("deleteField");return e._methodName="FieldValue.delete",new Jf(e)}static arrayUnion(...e){const t=function(...e){return new Pd("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Jf(t)}static arrayRemove(...e){const t=function(...e){return new xd("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Jf(t)}static increment(e){const t=function(e){return new Od("increment",e)}(e);return t._methodName="FieldValue.increment",new Jf(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Yf={Firestore:xf,GeoPoint:Id,Timestamp:ui,Blob:Rf,Transaction:Lf,WriteBatch:Mf,DocumentReference:Uf,DocumentSnapshot:Bf,Query:Kf,QueryDocumentSnapshot:zf,QuerySnapshot:$f,CollectionReference:Wf,FieldPath:Qf,FieldValue:Jf,setLogLevel:function(e){!function(e){Fr.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};var Xf;(Xf=_.Z).INTERNAL.registerComponent(new E.wA("firestore-compat",e=>{return t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate(),new xf(t,n,new Pf);var t,n},"PUBLIC").setServiceProps(Object.assign({},Yf))),Xf.registerVersion("@firebase/firestore-compat","0.1.13");var Zf=n(9765),ep=n(6682),tp=n(9746),np=n(3190),rp=n(7771),ip=n(5319),sp=n(7971),op=n(8858);class ap extends Zf.xQ{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new cp(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let s;if(this.closed)throw new sp.N;if(this.isStopped||this.hasError?s=ip.w.EMPTY:(this.observers.push(e),s=new op.W(this,e)),r&&e.add(e=new tp.ht(e,r)),t)for(let o=0;o<i&&!e.closed;o++)e.next(n[o]);else for(let o=0;o<i&&!e.closed;o++)e.next(n[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),s}_getNow(){return(this.scheduler||rp.c).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let s=0;for(;s<i&&!(e-r[s].time<n);)s++;return i>t&&(s=Math.max(s,i-t)),s>0&&r.splice(0,s),r}}class cp{constructor(e,t){this.time=e,this.value=t}}function up(e,t,n){let r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},e=>e.lift(function({bufferSize:e=Number.POSITIVE_INFINITY,windowTime:t=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,s,o=0,a=!1,c=!1;return function(u){let h;o++,!i||a?(a=!1,i=new ap(e,t,r),h=i.subscribe(this),s=u.subscribe({next(e){i.next(e)},error(e){a=!0,i.error(e)},complete(){c=!0,s=void 0,i.complete()}}),c&&(s=void 0)):h=i.subscribe(this),this.add(()=>{o--,h.unsubscribe(),h=void 0,s&&!c&&n&&0===o&&(s.unsubscribe(),s=void 0,i=void 0)})}}(r))}var hp=n(8049);function lp(e,t){return t?(0,np.w)(()=>e,t):(0,np.w)(()=>e)}var dp=n(3101);n(2329);const fp=new Map,pp={activated:!1,tokenObservers:[]},gp={initialized:!1,enabled:!1};function mp(e){return fp.get(e)||pp}function yp(e,t){fp.set(e,t)}function vp(){return gp}class wp{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new S.BH,await function(e){return new Promise(t=>{setTimeout(t,e)})}(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new S.BH,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const Ip=new S.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"}),Tp="firebase-app-check-store";let _p=null;const bp=new k.Yd("@firebase/app-check");function Ep(e,t){return(0,S.hl)()?function(e,t){return async function(e,t){const n=(await(_p||(_p=new Promise((e,t)=>{try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(Ip.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(Tp,{keyPath:"compositeKey"})}}}catch(n){t(Ip.create("storage-open",{originalErrorMessage:n.message}))}}),_p))).transaction(Tp,"readwrite"),r=n.objectStore(Tp).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(Ip.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{bp.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}const kp={error:"UNKNOWN_ERROR"};async function Sp(e,t=!1){const n=e.app;!function(e){if(!mp(e).activated)throw Ip.create("use-before-activation",{appName:e.name})}(n);const r=mp(n);let i,s=r.token;if(!s){const e=await r.cachedTokenPromise;e&&Cp(e)&&(s=e)}if(!t&&s&&Cp(s))return{token:s.token};let o,a=!1;if(vp().enabled){r.exchangeTokenPromise||(r.exchangeTokenPromise=async function({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=await fetch(e,s)}catch(l){throw Ip.create("fetch-network-error",{originalErrorMessage:l.message})}if(200!==o.status)throw Ip.create("fetch-status-error",{httpStatus:o.status});try{a=await o.json()}catch(l){throw Ip.create("fetch-parse-error",{originalErrorMessage:l.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw Ip.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const u=1e3*Number(c[1]),h=Date.now();return{token:a.attestationToken,expireTimeMillis:h+u,issuedAtTimeMillis:h}}(function(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}(n,await async function(){const e=vp();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}()),e.platformLoggerProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);const t=await r.exchangeTokenPromise;return await Ep(n,t),yp(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),s=await r.exchangeTokenPromise}catch(c){"appCheck/throttled"===c.code?bp.warn(c.message):bp.error(c),i=c}return s?(o={token:s.token},yp(n,Object.assign(Object.assign({},r),{token:s})),await Ep(n,s)):o=function(e){return{token:(t=kp,S.US.encodeString(JSON.stringify(t),!1)),error:e};var t}(i),a&&function(e,t){const n=mp(e).tokenObservers;for(const r of n)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch(c){}}(n,o),o}function Ap(e,t){const n=mp(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),yp(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function Np(e){const{app:t}=e,n=mp(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new wp(async()=>{let n;if(n=mp(t).token?await Sp(e,!0):await Sp(e),n.error)throw n.error},()=>!0,()=>{const e=mp(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e),yp(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function Cp(e){return e.expireTimeMillis-Date.now()>0}class Rp{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=mp(this.app);for(const t of e)Ap(this.app,t.next);return Promise.resolve()}}const Dp="app-check-internal";(0,b._registerComponent)(new E.wA("app-check",e=>{return t=e.getProvider("app").getImmediate(),n=e.getProvider("platform-logger"),new Rp(t,n);var t,n},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Dp).initialize()})),(0,b._registerComponent)(new E.wA(Dp,e=>{return t=e.getProvider("app-check").getImmediate(),{getToken:e=>Sp(t,e),addTokenListener:e=>function(e,t,n,r){const{app:i}=e,s=mp(i),o={next:n,error:void 0,type:"INTERNAL"};if(yp(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&Cp(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),Np(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Np(e))}(t,0,e),removeTokenListener:e=>Ap(t.app,e)};var t},"PUBLIC").setInstantiationMode("EXPLICIT")),(0,b.registerVersion)("@firebase/app-check","0.5.3");class Pp{constructor(){return(0,u.vb)("app-check")}}"undefined"!=typeof window&&window,n(7841);const xp=new i.OlP("angularfire2.auth.use-emulator"),Op=new i.OlP("angularfire2.auth.settings"),Lp=new i.OlP("angularfire2.auth.tenant-id"),Mp=new i.OlP("angularfire2.auth.langugage-code"),Fp=new i.OlP("angularfire2.auth.use-device-language"),Up=new i.OlP("angularfire.auth.persistence"),Vp=(e,t,n,r,i,s,o,a)=>(0,I.cc)(`${e.name}.auth`,"AngularFireAuth",e.name,()=>{const c=t.runOutsideAngular(()=>e.auth());if(n&&c.useEmulator(...n),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(const[e,t]of Object.entries(o))c.settings[e]=t;return a&&c.setPersistence(a),c},[n,r,i,s,o,a]);let qp=(()=>{class e{constructor(e,t,r,i,s,h,l,d,f,p,g,y){const v=new Zf.xQ,_=(0,c.of)(void 0).pipe((0,tp.QV)(s.outsideAngular),(0,np.w)(()=>i.runOutsideAngular(()=>Promise.resolve().then(n.bind(n,1390)))),(0,m.U)(()=>(0,I.on)(e,i,t)),(0,m.U)(e=>Vp(e,i,h,d,f,p,l,g)),up({bufferSize:1,refCount:!1}));if((0,T.PM)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,c.of)(null);else{_.pipe((0,hp.P)()).subscribe();const e=_.pipe((0,np.w)(e=>e.getRedirectResult().then(e=>e,()=>null)),u.iC,up({bufferSize:1,refCount:!1})),t=_.pipe((0,np.w)(e=>new o.y(t=>({unsubscribe:i.runOutsideAngular(()=>e.onAuthStateChanged(e=>t.next(e),e=>t.error(e),()=>t.complete()))})))),n=_.pipe((0,np.w)(e=>new o.y(t=>({unsubscribe:i.runOutsideAngular(()=>e.onIdTokenChanged(e=>t.next(e),e=>t.error(e),()=>t.complete()))}))));this.authState=e.pipe(lp(t),(0,dp.R)(s.outsideAngular),(0,tp.QV)(s.insideAngular)),this.user=e.pipe(lp(n),(0,dp.R)(s.outsideAngular),(0,tp.QV)(s.insideAngular)),this.idToken=this.user.pipe((0,np.w)(e=>e?(0,a.D)(e.getIdToken()):(0,c.of)(null))),this.idTokenResult=this.user.pipe((0,np.w)(e=>e?(0,a.D)(e.getIdTokenResult()):(0,c.of)(null))),this.credential=(0,ep.T)(e,v,this.authState.pipe((0,w.h)(e=>!e))).pipe((0,m.U)(e=>(null==e?void 0:e.user)?e:null),(0,dp.R)(s.outsideAngular),(0,tp.QV)(s.insideAngular))}return(0,I.pX)(this,_,i,{spy:{apply:(e,t,n)=>{(e.startsWith("signIn")||e.startsWith("createUser"))&&n.then(e=>v.next(e))}}})}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(I.Dh),i.LFG(I.xv,8),i.LFG(i.Lbi),i.LFG(i.R0b),i.LFG(u.HU),i.LFG(xp,8),i.LFG(Op,8),i.LFG(Lp,8),i.LFG(Mp,8),i.LFG(Fp,8),i.LFG(Up,8),i.LFG(Pp,8))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"any"}),e})();function jp(e,t){return function(e,t=s.z){return new o.y(n=>{let r;return null!=t?t.schedule(()=>{r=e.onSnapshot({includeMetadataChanges:!0},n)}):r=e.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(e,t)}function Bp(e,t){return jp(e,t).pipe((0,m.U)(e=>({payload:e,type:"query"})))}function zp(e,t){return Bp(e,t).pipe((0,h.O)(void 0),d(),(0,m.U)(([e,t])=>{const n=t.payload.docChanges(),r=n.map(e=>({type:e.type,payload:e}));return e&&JSON.stringify(e.payload.metadata)!==JSON.stringify(t.payload.metadata)&&t.payload.docs.forEach((t,i)=>{const s=n.find(e=>e.doc.ref.isEqual(t.ref)),o=null==e?void 0:e.payload.docs.find(e=>e.ref.isEqual(t.ref));s&&JSON.stringify(s.doc.metadata)===JSON.stringify(t.metadata)||!s&&o&&JSON.stringify(o.metadata)===JSON.stringify(t.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:t}})}),r}))}function Kp(e,t,n){return zp(e,n).pipe((0,y.R)((e,n)=>function(e,t,n){return t.forEach(t=>{n.indexOf(t.type)>-1&&(e=function(e,t){switch(t.type){case"added":if(!e[t.newIndex]||!e[t.newIndex].doc.ref.isEqual(t.doc.ref))return Gp(e,t.newIndex,0,t);break;case"modified":if(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref)){if(t.oldIndex!==t.newIndex){const n=e.slice();return n.splice(t.oldIndex,1),n.splice(t.newIndex,0,t),n}return Gp(e,t.newIndex,1,t)}break;case"removed":if(e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref))return Gp(e,t.oldIndex,1)}return e}(e,t))}),e}(e,n.map(e=>e.payload),t),[]),(0,v.x)(),(0,m.U)(e=>e.map(e=>({type:e.type,payload:e}))))}function Gp(e,t,n,...r){const i=e.slice();return i.splice(t,n,...r),i}function $p(e){return e&&0!==e.length||(e=["added","removed","modified"]),e}class Wp{constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=zp(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,m.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)))),t.pipe((0,h.O)(void 0),d(),(0,w.h)(([e,t])=>t.length>0||!e),(0,m.U)(([e,t])=>t),u.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,y.R)((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=$p(e);return Kp(this.query,t,this.afs.schedulers.outsideAngular).pipe(u.iC)}valueChanges(e={}){return Bp(this.query,this.afs.schedulers.outsideAngular).pipe((0,m.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data())),u.iC)}get(e){return(0,a.D)(this.query.get(e)).pipe(u.iC)}add(e){return this.ref.add(e)}doc(e){return new Hp(this.ref.doc(e),this.afs)}}class Hp{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:r,query:i}=eg(n,t);return new Wp(r,i,this.afs)}snapshotChanges(){return jp(this.ref,this.afs.schedulers.outsideAngular).pipe((0,h.O)(void 0),d(),(0,m.U)(([e,t])=>t.exists?(null==e?void 0:e.exists)?{payload:t,type:"modified"}:{payload:t,type:"added"}:{payload:t,type:"removed"})).pipe(u.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,m.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,a.D)(this.ref.get(e)).pipe(u.iC)}}class Qp{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?zp(this.query,this.afs.schedulers.outsideAngular).pipe((0,m.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)),(0,w.h)(e=>e.length>0),u.iC):zp(this.query,this.afs.schedulers.outsideAngular).pipe(u.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,y.R)((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=$p(e);return Kp(this.query,t,this.afs.schedulers.outsideAngular).pipe(u.iC)}valueChanges(e={}){return Bp(this.query,this.afs.schedulers.outsideAngular).pipe((0,m.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign({[e.idField]:t.id},t.data()):t.data())),u.iC)}get(e){return(0,a.D)(this.query.get(e)).pipe(u.iC)}}const Jp=new i.OlP("angularfire2.enableFirestorePersistence"),Yp=new i.OlP("angularfire2.firestore.persistenceSettings"),Xp=new i.OlP("angularfire2.firestore.settings"),Zp=new i.OlP("angularfire2.firestore.use-emulator");function eg(e,t=(e=>e)){return{query:t(e),ref:e}}let tg=(()=>{class e{constructor(e,t,n,r,i,s,o,u,h,l,d,f,p,g,m,y,v){this.schedulers=o;const w=(0,I.on)(e,s,t),_=h;l&&Vp(w,s,d,p,g,m,f,y),[this.firestore,this.persistenceEnabled$]=(0,I.cc)(`${w.name}.firestore`,"AngularFirestore",w.name,()=>{const e=s.runOutsideAngular(()=>w.firestore());if(r&&e.settings(r),_&&e.useEmulator(..._),n&&!(0,T.PM)(i)){const t=()=>{try{return(0,a.D)(e.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(t){return"undefined"!=typeof console&&console.warn(t),(0,c.of)(!1)}};return[e,s.runOutsideAngular(t)]}return[e,(0,c.of)(!1)]},[r,_,n])}collection(e,t){let n;n="string"==typeof e?this.firestore.collection(e):e;const{ref:r,query:i}=eg(n,t),s=this.schedulers.ngZone.run(()=>r);return new Wp(s,i,this)}collectionGroup(e,t){const n=t||(e=>e),r=this.firestore.collectionGroup(e);return new Qp(n(r),this)}doc(e){let t;t="string"==typeof e?this.firestore.doc(e):e;const n=this.schedulers.ngZone.run(()=>t);return new Hp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(I.Dh),i.LFG(I.xv,8),i.LFG(Jp,8),i.LFG(Xp,8),i.LFG(i.Lbi),i.LFG(i.R0b),i.LFG(u.HU),i.LFG(Yp,8),i.LFG(Zp,8),i.LFG(qp,8),i.LFG(xp,8),i.LFG(Op,8),i.LFG(Lp,8),i.LFG(Mp,8),i.LFG(Fp,8),i.LFG(Up,8),i.LFG(Pp,8))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),ng=(()=>{class e{constructor(e){this.database=e}create(e,t){return(0,r.mG)(this,void 0,void 0,function*(){try{return yield this.database.collection(e).add(t)}catch(n){console.log("error en create: ",n)}})}getAll(e){return(0,r.mG)(this,void 0,void 0,function*(){try{return yield this.database.collection(e).snapshotChanges()}catch(t){console.log("Error en getAll: ",t)}})}getById(e,t){return(0,r.mG)(this,void 0,void 0,function*(){try{return yield this.database.collection(e).doc(t).get()}catch(n){console.log("Error en el getById: ",n)}})}update(e,t,n){return(0,r.mG)(this,void 0,void 0,function*(){try{return yield this.database.collection(e).doc(t).set(n)}catch(r){console.log("Error en el delete: ",r)}})}delete(e,t){return(0,r.mG)(this,void 0,void 0,function*(){try{return yield this.database.collection(e).doc(t).delete()}catch(n){console.log("Error en el delete: ",n)}})}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(tg))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);